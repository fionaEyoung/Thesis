\section{Data requirements}

\note{Basically the findings from ISMRM diffusion workshop with different data inputs.}

\section{Atlas training volume}

In segmentation methods relying on seen data from which to ``learn" patterns to apply to unseen data, the volume and range of training data influences the prediction accuracy and generalisability. \note{says who?}
For complex deep learning models, which have many thousands of network parameters to learn, the amount of training data required to achieve accurate and stable performance can be immense, posing a particular barrier to the use of such models in applications where suitably annotated data is scarce.
In the case of TractSeg, for example, 105 subjects in total were used for cross-validation training, which each fully trained model having seen 63 unique subjects \note{also mention augmentation?}.

In tractfinder, the influence of the number of subjects used to construct each atlas is on the amount of inter-subject anatomical variation reflected in the spatial and orientational components.
It is to be expected that, save for extreme outliers, the additional information gained from adding more training subjects would reach a point of saturation.

To investigate this, an experiment was conducted whereby the number of subjects included in atlas construction was varied, and the effect on segmentation accuracy compared.
For this purpose the TractSeg \gls{hcp} reference bundles were used.
Using the same train - test data split as described in \note{??}, subsets of 1, 3, 5, 10, 15 and 30, as well as the full 63 training subjects were randomly selected, from which separate \gls{tod} atlases where constructed.
Tractfinder tract maps were then generated in the 42 test subjects using each of the different subset atlases and compared with the reference segmentations using the \gls{dice} and density correlation metrics.

\begin{figure}
    \includegraphics{compare_ntrain.png}
    \caption{Comparison of segmentation performance using different numbers of atlas training subjects. Results are grouped by tract, colour represents number of training subjects. The IFO and \gls{or} are in places indistinguishable. \acrolist{af,cst,or}}
    \label{fig:ntrain}
\end{figure}

When using only a single subject's normalised \gls{tod} map as an ``atlas", mean \gls{dice}s ranged from 0.65 to 0.71 for the IFOF and \gls{cst} respectively.
% These figures are from using the script compare_atlas_size.py committed at sha 33777217
The maximum increase in mean \gls{dice} between the 15 and 63 subjects atlases was only 0.00835, for the \gls{cst}, representing only a 1\% increase from the lower score of 0.759.
Across all tracts and both comparison metrics, differences in performance between the different atlases was consistently negligible.

The results indicate that additional atlas subjects beyond a minimum number of around 10 to 15 do little to nothing to improve tractfinder results.
This can be interpreted as the additional training subjects offering minimal additional information on inter-subject variability, as a lot of this variability is already smoothed out due to affine (instead of diffeomorphic) co-registration of training subjects into template space.
The effects of additional training data may present differently if the atlases are constructed with non-linear co-registration of training subjects.

\note{this might belong somewhere else.}
There are two sources of inter-subject variability wrapped up in the atlas: the first is the global anatomical variability including skull shape and differences in cortical shape and arrangement \note{better word for this}.
The second is the variability in position and shape of the tract itself.
Under ideal circumstances, diffeomorphic registration of training subjects would eliminate the first of these effects (global variability), leaving only the tract specific variation.
However, such an atlas would necessitate subsequent applications in new target subjects to also involve diffeomorphic registration between subject and template space, as the atlas would contain no global variability ``allowance", and would therefore expect to be perfectly aligned with a target image, globally speaking \note{good lord}.
Requiring diffeomorphic registration at the point of application would greatly inhibit the robustness and speed of tractfinder, and is therefore not the preferred approach.
