\chapter{Practical application}

\section{Data requirements}

\note{Basically the findings from ISMRM diffusion workshop with different data inputs.}


It is important to assess the applicability of image processing techniques developed with research quality data in acquisitions more typical of a clinical setting.
It is common for advanced \gls{dmri} processing techniques to \note{require} a certain set of constraints on the input data, such as recommending or requiring a minimum number of diffusion weighted volumes (angular resolution), $b$-values or spatial resolution.

If you can demonstrate that an image processing pipeline produces excellent results in a high quality research dataset, which can be interpreted with confidence, then the question follows: where one to acquire a lower quality dataset of the same subject, and perform the same data processing, how comparable would the resulting segmentation be to that of the high quality scan?

It is fairly straightforward to explore this question, given a high quality sample dataset.
Such data can be downsampled, in both the spatial and angular domains, to produce a simulated lower quality scan of the same subject.
Here we set out to determine the minimum data requirements to obtain successful segmentation, comparing different numbers of direction samples, $b$-values and post-processing strategies, as well as the affects of decreasing data quality on segmentation stability.
The effects on the perfomance of TractSeg and tractography are compared as well.

\subsection{Data and methods}

49 Preprocessed dMRI datasets from the HCP 1200 data release were spatially resampled to 2.5mm isotropic voxel size (from the original of 1mm isotropic), a resolution far more common in both clinical and research settings.
Then, for each subject, the following 5 subsampled diffusion schemes were extracted from the full dataset (see Tab. \ref{tab:subschemes}):
60 directions each at $b=1000s/mm^2$ and $b=2000s/mm^2$ (120 directions total, ``DWI-1”), 30 directions each at $b=1000s/mm^2$ and $b=2000s/mm^2$ (60 directions total, ``DWI-2”), 60 directions at $b=1000s/mm^2$ (``DWI-3”), 30 directions at $b=1000s/mm^2$ (``DWI-4”) and 12 directions at $b=1000s/mm^2$ (``DWI-5”).

\begin{table}
  \centering
  \begin{tabular}{c c c}
    Identifier & $b = 1000$ & $b=2000$ \\
    \hline
    DWI-1 & 60 & 60 \\
    DWI-2 & 30 & 30 \\
    DWI-3 & 60 &    \\
    DWI-4 & 30 &    \\
    DWI-5 & 12 &    \\
  \end{tabular}
  \caption{Subsampled diffusion schemes}
  \label{tab:subschemes}
\end{table}

For each dataset four different tract segmentations are produced using three different approaches: Tractfinder, targeted ROI-based, probabilistic streamline tractography (iFOD2), and TractSeg.
TractSeg, a deep learning-based direct segmentation technique, ships with two different pre-trained models:
one trained on tract segmentations obtained as described in Wasserthal et al. (2018) (``TractSeg - DKFZ”), and another trained on XTRACT7 outputs (``TractSeg - XTRACT”).
Two different TractSeg results were obtained by running both models.
Segmentations were compared for the three tracts most commonly reconstructed in neurosurgical applications: the corticospinal tract, arcuate fasciculus and optic radiations.
All tract segmentation methods are predicated on fibre orientation distributions (FOD) modelled from diffusion data, and although tractography and TractSeg could both use other FOD modelling outputs such as BedpostX, the current analysis is kept to constrained spherical deconvolution (CSD) only.
For the two-shelled datasets, multi-shell multi-tissue (MSMT) CSD10 can be run to separate the signal contributions from white matter (WM), grey matter (GM) and cerebrospinal fluid (CSF) and thus obtain an optimal WM FOD image free of noisy extraneous signal in non-WM regions.
For the single-shelled datasets, full, direct MSMT with all three tissue types is not possible.
Instead, the following approaches are compared: 1) Modelling two tissue types with MSMT.
MSMT CSD is performed twice, once modelling WM and GM compartments, and once modelling WM and CSF compartments; 2) Standard single shell CSD ``original flavour".

To investigate the effects of different data quality and modelling on a given method, the Dice similarity coefficient (DSC) is computed between each segmentation in datasets DWI 2-5 and the corresponding segmentation of the same method in DWI 1 using MSMT (considered the baseline segmentation).
This ``self-similarity" approach is intended to answer the question put forward above: how close to the results produced from an ``ideal" dataset be achieved from a lower quality dataset.
This comparison was made for each combination of data quality and CSD approach.

\subsection{Findings}

\begin{figure}
  \includegraphics{chapter_4/self_dice.png}
  \caption{Self dice scores \note{caption}}
  \label{fig:self_dice}
\end{figure}

DSC results are plotted in Figure \ref{fig:self_dice}.
Each datapoint corresponds to the segmentation produced from a particular dataset, method and pipeline \textit{compared against} the result obtained from the highest quality dataset.

The consistency in segmentation results differed significantly with both data quality and CSD approach.
The high sensitivity to CSD approach in the tractography and Tractfinder results, particularly the large differences between MSMT WM+CSF / SSST and MSMT WM+GM, can be attributed to the amount of spurious grey matter signal included in the WM FOD reconstructions.
In the former two approaches, the GM compartment is not as aggressively suppressed from the WM reconstruction, resulting in WM ``signal” in grey matter areas (which is then incorporated into the segmentation: in tractography via the further propagation of streamlines into GM, and in Tractfinder directly due to higher WM signal amplitude in GM).
TractSeg, while not immune, appears less sensitive to CSD reconstruction technique.
When considering only the best results (MSMT in DWI-2 and, in the single-shelled datasets, MSMT WM+GM for tractography and Tractfinder and SSST for TractSeg; Fig. 2), tractography displays the greatest instability with decreasing data quality, with the similarity score between DWI-5 MSMT WM+GM and DWI-1 MSMT falling as low as 0.78 (subject and cerebral hemisphere mean) for the arcuate fasciculus.
TractSeg is trained on SSST CSD in single-shelled data as well as multi-shelled data, explaining why it does best with either SSST or MSMT WM+CSF in our single-shell results.

The comparatively high sensitivity of probabilistic tractography to acquisition and processing pipelines is consistent with the well-established reproducibility and noise sensitivity problems associated with tractography.
Meanwhile, voxel-wise segmentation methods are not susceptible to error propagation along the tract and are more robust to lower angular resolution.
Understanding the behaviour of different tract segmentation techniques when applied to varying qualities of dMRI acquisition and post-processing approaches is important if segmentation methods developed in research settings are to be consistently and reproducibly applied to clinical quality acquisitions.
It is useful to know how comparable segmentation results in a single-shelled, 30 direction dataset are to those one might have obtained with a HARDI dataset and state-of-the-art post-processing.
This is particularly relevant for longitudinal studies, or when comparing different acquisitions of the same subject in a clinical context (e.g., for monitoring disease progressions, post-operative changes etc.).
