\chapter{Tract Orientation Atlas}
\label{chap:atlas}

\note{Somehow also include the ``mapping" part in the chapter title?}

The chosen approach to fulfil the aims laid out in section \ref{sec:problem} combines aspects of both traditional atlas-based and direct data-driven approaches to segmentation.
It is clear that the task of \gls{wm} tract identification cannot be accomplished without incorporating anatomical priors, and that those priors cannot account for individual differences.
The incorporation of anatomical priors can be automated for streamline tractography, as is done for several prior works including the FSL tool XTRACT\autocite{Warrington2020} and the white matter query language framework.\autocite{Wassermann2016}
These approaches still rely on tractography as the means for parsing the local orientation information in the test subject, and consequently inherit many associated drawbacks such as the computational time and power required for whole brain tractography, or the difficulties tracking through oedema or around tumours.
As an alternative to tractography, in which the attribution of a voxel to a tract of interest is contingent on it being visited by a streamline which, based on its entire length, has been attributed to the tract, we will instead develop a voxel-wise approach, in which a voxel can be associated with a tract based on its local diffusion properties and global coordinates.

We'll thus consider a voxel's membership with a target tract to be determined by its location in the brain and local directional diffusion characteristics, and how well they align with prior expectations for the tract.
This chapter is concerned with the encoding of those expectations in the form of a tract-specific location and orientation atlas, and the voxel-wise comparison of those expectations with observed directional diffusion information.
The necessary intermediate step, of establishing spatial correspondence between the atlas and observed data, will be the subject of Chapter \ref{chap:reg}.

\section{Theoretical motivation}

The tract orientation atlas aims to capture the typical spatial and orientational distribution of a bundle across a sample of healthy subjects.
In order to motivate its format and derivation, it is worth first considering the information channels aimed to be contained within the atlas and their interpretation.

First is the spatial distribution, i.e. the likelihood of finding the tract in a given voxel.
How should we quantify this likelihood?
At the individual level, this is sometimes conflated with or loosely equated to streamline density derived from tractography, when in reality the relative densities between different portions of a streamline bundle have far more to do with the biases of tracking algorithms than the underlying anatomy.
Instead, let's imagine we pick a single \gls{voxel} in a brain scan and ask, ``are fibres of the \gls{cst} present in this voxel?".
In attempting to answer this question, we encounter several sources of uncertainty.

\textit{a) Definitional uncertainty.}
While we can more or less agree that the \gls{cst} forms the pyramids of the medulla at one end, and terminates in the primary motor cortex in the precentral gyrus at the other, its precise boundaries in the subcortical \gls{wm} are less obvious.
Within the corona radiata, for instance, where is the transition, if a clear one exists, between motor fibres and ascending sensory pathways?
This lack of highly detailed neurophysiological knowledge is our first source of uncertainty.

\textit{b) Inter-subject variability.}
Even if we could nail down the exact shape of a pathway in a hypothetical ideal brain, we would be left to contend with natural differences in brain shape and organisation.
How can we know if, in this particular individual, the transition from afferent to efferent fibres occurs slightly more posteriorly than on average?

\textit{c) Measurement uncertainty.}
Suppose we have overcome our doubts about the expected shape of the \gls{cst} in our specific individual.
Our voxel is in or near the tract's domain, but it also sits adjacent to grey matter.
The diffusion profile measured in this voxel is consistent with the presence of some fibres travelling in the expected direction, but only according to one estimate of the \gls{fod}, using \gls{ssst} \gls{csd}.
Using \gls{msmt} \gls{csd}, we obtain a different \gls{fod}, one which doesn't align with the expected \gls{cst} fibres, suggesting the data only weakly supports the presence of such fibres, and possibly only thanks to an artefact or noise.
% This measurement and modelling uncertainty, incidentally, is what is captured in the probabilistic tractography algorithm probtrackx.\autocite{Behrens2007}

Faced with this tangle of unknowns, we have chosen a simplistic route.
At the individual level, we will decide upon a theoretical bundle structure that is best supported by known neuroanatomy (effectively eliminating the definitional uncertainty), and attempt to faithfully reconstruct that structure using probabilistic streamline tractography and careful manual filtering of implausible streamlines.
From this reconstruction we will derive a binary spatial segmentation, effectively assuming no measurement uncertainty for the purpose of training an atlas. % \note{disregarding all those uncertainties?}
By repeating this process and considering the differences in segmentations across a population of reference subjects, we will in doing so capture an approximation of the inter-subject variability.
% its true we cant trust the mri signal so theres some uncertainty associated with that but given that we don't have a definitive definition of where the tract is even in a perfect situation with zero measurement uncertainty, trying to disentangle the ``we don't know if this voxel contains the tract necessarily because the signal might be noisy" and ``we don't know if the tract is here because we don't actually have a specific definition of the tract's anatomy" is sort of pointless. So we might as well decide on a definition and, wherever that definition is supported by the data we have via the presence of anatomically plausible streamlines, we'll define that voxel as having the tract.

The second channel of information to be conveyed in the atlas is the orientation distribution, meaning the spread of likely directions along which the fibres of a bundle might be travelling at a given location.
This property, too, is subject to uncertainties as described above.
However, once a tract's location is known, or at least assumed, we can in most cases be fairly certain of its local orientations based on our knowledge of its global shape and trajectory.
In a multi-fibre voxel, the distinct population in the apparent \gls{fod} which corresponds to our tract of interest is assumed to be known.
In this case, tractography which probabilistically draws samples from that distribution will reconstruct some streamlines travelling through that voxel in a distribution of directions consistent with our expectations for that tract, alongside potential spurious streamlines traversing the voxel in the ``wrong" direction.
After carefully ensuring, as much as is feasible, that only those consistent streamlines remain, we can retrieve the orientation distribution of the tract of interest in isolation from the other crossing populations using \gls{tod} mapping.
% The objective is to create a map in a template space capturing, at each location, the range of possible orientations the tract can take on as a single spherical distribution.
After aggregating this information in template space we should be left with a single spherical distribution per voxel expressing the range of possible orientations typical of the tract.
A narrow distribution may be found where the tract's orientation is highly consistent across all subjects, whereas a more spread-out distribution would reflect a wider inter-subject variability, which may be seen in regions of fanning or sharp turning (Fig. \note{fig:mean}).

To obtain such a mapping, a combination of streamline tractography and \gls{tod} mapping \autocite{Dhollander2014} is used.
While tractography has significant limitations as discussed previously, it remains the standard way of segmenting white matter bundles from \textit{in vivo} dMRI data, and biases and errors can, with appropriate post-processing steps, be at least partially corrected for.
In addition, tractography uniquely enables the extraction of orientation information specific to the reconstructed bundle, which would not be possible from a binary voxel-wise segmentation.
Being derived from carefully curated streamline tractography reconstructions, we can conceptualise the atlas as a store of anatomical prior expectations which would otherwise be utilised to draw appropriate ROIs for tractography in a target image.

\section{Tract definitions}

It is important that the atlases closely reflect the anatomical definitions most prevalent in the literature, and most useful for clinical applications.
To this end, an extensive literature search was conducted for each tract before confirming the \gls{roi} strategy that would in turn determine the shape of its normative atlas.
A combination of neuroanatomical studies using blunt dissection, functional studies using either non-invasive methods including \gls{fmri} or intraoperative functional stimulation were sought out as well as tractography studies detailing recommended \gls{roi} strategies.

There is of yet no perfect method for determining the exact course of individual white matter fibres in the human brain.
A technique called tract-tracing, which involves the invasive injection of tracer compounds \textit{in vivo} and subsequent post-mortem histological analysis, is widely accepted as the gold standard, but only ethically feasible in monkeys, and there is disagreement and controversy surrounding the transferability of tract definitions between no-human primates and humans.\autocite{Becker2022,ThiebautdeSchotten2012}
Blunt dissection in post-mortem specimens, greatly advanced through the fixation methods developed by Joseph Klingler (1888-1963) in the early 20th century,\autocite{Agrawal2011} is therefore the most direct technique available for studying global white matter anatomy in humans.
Though greatly advancing the study of white matter anatomy and widely used to evaluate the findings of tractography studies, post-mortem dissections, in which layers of white matter fibres are painstakingly separated and isolated, cannot flawlessly uncover the complete and intact extent of an entire bundle,\autocite{Martino2010, Dick2012} and its findings have also been subject of rigorous debate (see, for example, \textcite{Giampiccolo2022a,Becker2022,Giampiccolo2022b}).
Nevertheless, post-mortem dissection and \textit{in vivo} functional evidence from intraoperative \gls{des} are preferred over conclusions drawn from purely non-invasive tractography for informing our tract definitions.
By relying wherever possible on such ``primary source" evidence, we hope to avoid the circularity of basing our understanding of a tract's anatomy on tractography studies alone. %\note{explain this better}
For example, there are several studies describing the cortical terminations of streamlines in tract reconstructions and presenting them as evidence for connectivity,\autocite{Conner2018,Hau2016} when in reality inferring the existence of a physical connection based on tractography alone is highly inadvisable.\autocite{Rheault2020}

For projection tracts, such as the optic radiation, the function and anatomy almost define each-other: the optic radiation transmits optical signals from the thalamus to the first point of contact in the cortex, the primary visual cortex.
With association tracts, one can observe a backwards and forwards between deducing possible cortical terminations based on observed function, e.g. particular functional deficits induced through stimulation of the core of the tract, and theorising on possible functions based on observed cortical terminations, e.g. through blunt postmortem dissections.

Once an anatomical definition was decided upon based on the balance of available evidence, tractography studies detailing recommended \gls{roi} strategies were compared.
Prior studies acted as guidance for the choice of \glspl{roi} used for each tract if a clear consensus consistent with the chosen definition emerged.
Due to the difficulties in constraining tractography streamlines as they approach the cortex, grey matter \glspl{roi} derived from cortical parcellations were used wherever practical.

As is invariably necessary for probabilistic tractography, additional exclusion ROIs are needed to filter false positive streamlines that are clearly not part of the tract, and would not feasibly be included in the tract in an alternative definition.
These include, for example, midline exclusion ROIs to remove \gls{cst} streamlines straying into the corpus callosum, or a posterior ROI to exclude \gls{af} streamlines from propagating into the occipital lobe.
These exclusion ROIs will not be described, as their motivation is trivial.
There are, however, some examples of explicitly excluding streamlines that would be included in another definition of the same bundle.
For example, the definitions of the \gls{cst} include the afferent dorsal-column medial lemniscus system within the brainstem, whereas in tractfinder these fibres are explicitly excluded.
Where relevant, such distinctions are described below.

\subsection{Optic radiation}

\begin{SCfigure}[][htb!]
  \includegraphics[width=0.5\textwidth]{chapter_2/or_schema_Ebeling1988.png}
  \caption{\note{draft} Schematic of optic radiation, from \textcite{Ebeling1988}}
  \label{fig:or}
\end{SCfigure}

As a projection tract, the \gls{or} is among the more easily definable in terms of its end points.
Arising from the \gls{lgn} of the thalamus, its fibres swoop around the lateral ventricle, some directly and some in an elaborate arc reaching as far forward as the tip of the lateral ventricle's temporal pole before curving back towards the occipital lobe in a formation named Meyer's loop (Fig. \ref{fig:or}).\autocite{Sarubbo2015}
As it projects towards the most posterior reaches of the occipital lobe, the \gls{or} forms part of the \gls{ss}, a confluence of fibres superficial to the \gls{trigone}, comprising the antero-posteriorly oriented fibres of association and projection fibres of the occipital, temporal and frontal lobes.\autocite{Maldonado2021}
The fibres of the optic radiation, conferring low-level visual data on contrast, colour and shapes, then terminate in the primary visual areas of the occipital cortex surrounding the calcarine fissure.

When it comes to the course of the optic radiations through the \gls{ss} and posterior termination in the occipital lobes, there is no disagreement between targeted tractography and other segmentation methods.
However, there remain significant differences in the regions of the \gls{lgn} and \gls{ml}.
The \gls{lgn} is a small nucleus, its localisation on MRI images is not straightforward, resulting in often very generous \glspl{roi} including most of or even the entire ipsilateral thalamus.
In addition, due to the complex arrangement of white matter structures in the upper midbrain and thalamus regions, it is easy for streamlines to extend into the entire posterior thalamus and fornix and even descend into the brainstem.
This contributes to often broad \gls{or} segmentations in the thalamic portion at the start of the tract.
Secondly, the full anterior extent of Meyer's loop is often not comprehensively reconstructed by tractography, due to the extreme and tight curvature.\autocite{Lilja2015,Chamberland2018}

The \gls{or} is unsurprisingly an integral structure for visual function and thus quality of life.
With the extension of \gls{ml} deep into the temporal pole, this structure is at high risk of injury in common surgeries for treatment of epilepsy, often resulting in postoperative visual field deficits.\autocite{Lacerda2020}
Evidence of \gls{or} infiltration by tumours as evidenced by preoperative tractography has been significantly correlated with worse postoperative visual outcomes.\autocite{Soumpasis2023}
Intraoperative mapping with subcortical \gls{des} can be used to assess for visual field deficits during surgery,\autocite{Duffau2004a,Mazerand2017} although \textcite{Shahar2018} have suggested that this may be of limited value if visual responses can only be elicited once the resection has already reached a critical proximity to the tract.

To achieve the best possible representation of this important pathway, the LGN was segmented with precision in all training subjects using the incoming optic tracts and relative positioning with the cerebral peduncles for orientation.
Using the \gls{lgn} for seeding, an inclusion waypoint was drawn around the \gls{ss} \gls{roi} on the coronal plane.
Finally, to improve the coverage of Meyer's loop, an anterior waypoint was positioned just posterior to the anterior pole of the temporal horn.
Since not all of the \gls{or} takes the full scenic route, tractography was run with and without this additional anterior waypoint and the two sets of streamlines combined.

\subsection{Corticospinal tract}

\begin{SCfigure}[][htb!]
  \includegraphics[width=0.5\textwidth]{chapter_2/cst_schema_Ebeling1992.png}
  \caption{\note{draft} Schematic of corticospinal tract, from \textcite{Ebeling1992}}
  \label{fig:cst}
\end{SCfigure}

Voluntary movement is the cornerstone of life and our means of interacting with the outside world, without which motion, speech, and vision would be impossible.
It stands to reason that an outsized portion of the central nervous system is dedicated to the precise innervation of muscles throughout the body, from the fine control of vocal chords to automated touch-typing, and that such a vast repertoire of motor function is mediated by an intricate interplay of different systems including the basal ganglia circuits, cerebellum and the sensori-motor cortices of the cerebral hemispheres.\autocite{Kandel2021}
Within the primary motor cortex, situated in the precentral gyri, are the bodies of neurons whose axons project all the way into the spinal chord, where they synapse with the motor neurons of the peripheral nervous system to control muscles.
These axons, together, form a critical pathway called the corticospinal tract (Fig. \ref{fig:cst}).
Standardised white matter atlases and tractography protocols varyingly describe the corticospinal and pyramidal tracts.
These two terms are often used interchangeably in tractography-oriented publications, while in anatomical terms they are distinct:
Somewhat bafflingly, the pyramidal tracts are commonly defined as encompassing both the \gls{cst} and the corticobulbar (or corticonuclear) tract, the latter of which synapses with cranial nerve nuclei of the medulla to control motion of the head, neck and face.\autocite{Chenot2019}
This despite the fact that only the \gls{cst} fibres continue to form the pyramids of the medulla, after which pyramidal tract is named.
Since the two are not practically distinguishable on \gls{dmri} from the brainstem upwards, we will hereon refer only to the corticospinal tract.% \note{reference this section}
%
% Tractography studies and related white matter segmentation research sometimes conflate the major descending (motor) and ascending (sensory pathways), whether intentionally or not.
% This is evident in two main regions.
% Firstly, the inclusion of the medial lemniscus is frequently seen in \gls{cst} segmentations (usually as it is not explicitly excluded, rather than being actively included).
% This includes TractSeg (and associated reference streamline bundles), XTRACT to some extent, and TractoInferno.
% By contrast, the tractography protocol employed in this research includes an exclusion mask on the medial lemniscus.
% Secondly, while it has been suggested that the primary motor cortex can reside in the post-central gyrus,\autocite{Kumar2009} it is generally accepted that the somatosensory cortex is located in the latter, while the motor areas are in the precentral gyri.
% However, particularly with probabilistic tractography, it is near impossible to constrain streamlines exiting the internal capsule into the fanning corona radiata to one side of the central sulcus, without additional exclusion planes or the use of cortical target regions, which are especially time-consuming to produce, whether manually or through automatic parcellation.
% Thus streamline-based CST segmentations often contain parts of the somatosensory cortex\autocite{Poulin2021} while others, such as those utilising cortical parcellation-derived target regions, will be restricted to the motor cortex.

Classically, the \gls{cst} was thought to arise solely from the primary motor cortex (M1), with supportive areas including supplementary motor and somatosensory areas mediating voluntary movement via interaction with M1.
More recent analysis has revealed that these secondary cortices also send projections directly via the \gls{cst},\autocite{Kandel2021} with up to 35\% of neurons originating in non-motor (primary and supplementary) areas, although these figures are based on animal studies.\autocite{Welniarz2017}
Evidence in humans for non-primary motor cortex origins of \gls{cst} fibres is limited to tractography and lesion studies.\autocite{Kumar2009,Jane1967}
However, particularly with probabilistic tractography, it is near impossible to constrain streamlines exiting the internal capsule into the fanning corona radiata to only a narrow region of cortex, and of course tractography is unable to distinguish efferent and afferent pathways.
Thus streamline-based \gls{cst} segmentations often contain parts of the somatosensory cortex whether intentionally or not.\autocite{Poulin2021}
In another conflation of descending and ascending pathways, the inclusion of the medial lemniscus is frequently seen in \gls{cst} segmentations (usually as it is not explicitly excluded, rather than being actively included).\autocite{Wasserthal2018,Warrington2020,Poulin2021}

The tractfinder CST atlas streamlines were obtained using Freesurfer parcellations \autocite{Desikan2006,FischlSalat2002} of the primary motor cortex.
To boost the coverage of the lateral precentral gyrus,\autocite{Ebeling1992} which is typically neglected by tractography due to the difficulty in crossing the centrum semiovale and its preference for taking the straightest path, two sets of streamlines were generated.
First, streamlines were seeded from the entire precentral gyrus, with include regions on the cerebral peduncles and mid-pons level, retaining the coordinates of the successful (included) seeds.
Then, a dilated mask of those coordinates was subtracted from the motor cortex mask, and the tracking was repeated from this modified low-count seed mask.
An exclusion \gls{roi} on the medial lemniscus in the mid-pons excludes afferent fibres at the brainstem level.

\subsection{Arcuate fasciculus}

% \begin{quote}
%   In dieser Windung liegt der starke hakenförmige Markbündel, welcher beide Hirnlappen verbindet und gleichsam als der eigentliche Schlüssel zur Organisation der Sylvischen Grube angesehen werden muss.
%
%   [In this curve lies the strongly hook-shaped matter bundle, which connects both brain lobes and must be regarded as the essential key to the organisation of the Sylvian fissure.] (\citeauthor{Reil1809}, \citeyear{Reil1809}\autocite{Reil1809})
% \end{quote}
% % In 1809,  wrote:

\begin{SCfigure}[][htb!]
  \includegraphics[width=0.5\textwidth]{chapter_2/af_schema_Geschwind1970.png}
  \caption{\note{draft} Schematic of arcuate fasciculus, from \textcite{Geschwind1970}}
  \label{fig:af}
\end{SCfigure}

The \gls{af} has long held the fascination of neuroscientists, anatomists and psychologists since its earliest descriptions in the 19th century.\autocite{Burdach1822}
Ever since, the nomenclature and anatomical description of the \gls{af} has been the subject of much disagreement and confusion, with researchers variably dividing it into a series of subcomponents, disputing its cortical terminals and declaring it synonymous with either part or all of the \gls{slf}.
A comprehensive review of this jumble and its history can be read in \textcite{PortodeOliveira2021}.
Intertwined with this discussion on the white matter connections between (and within) frontal and temporal lobes are the ever-evolving models of language reception, processing and production in the human brain.\autocite{Becker2022a}
In particular, conflicts over the distinction between the \gls{slf} and \gls{af} and their respective terminations in the superior, middle or inferior temporal gyri are directly motivated by a desire to disentangle the distribution of different language associated functions in the temporal cortex and their processing by means of the dorsal and ventral language streams.\autocite{Hickok2004,Friederici2013a,Kljajevic2014a,Giampiccolo2022a,Becker2022a}

Even the core precondition for the classical definition of the \gls{af}, namely the existence of a direct connection between the inferior frontal gyrus (loosely, Broca's area) and the posterior superior temporal gyrus (Wernicke's area), has been called into question.\autocite{Dick2012,Giampiccolo2022a}
While we cannot dispute the existence of a core bundle of fibres arching around the Sylvian fissure, no-one can seem to agree on where exactly those fibres are headed, in either direction.
Within the temporal lobe, attempts to definitively disentangle the \gls{af} from other temporal lobe tracts have fallen short,\autocite{Becker2022} and with regards to the frontal terminations, there is disagreement over the relationships between the various dorsal stream components and the premotor cortex and inferior frontal gyrus.\autocite{Kljajevic2014a,Giampiccolo2022a}

Numerous lengthy articles and thesis chapters have been devoted to this discussion, and it is beyond the scope of this short review to attempt a definitive summary.
Instead, for the purposes of this report, we will consider only the narrowest and perhaps most canonical definition of the \gls{af}: that of a bundle connecting the posterior-superior aspect of the temporal lobe with the inferior frontal gyrus (Fig. \ref{fig:af}), with a critical role in speech production.\autocite{Baldo2015}
By this definition, we will exclude longer extensions into the anterior temporal cortex\autocite{Giampiccolo2022a} and any frontal gyri other than the inferior frontal gyrus, and reject the tripartite paradigm which includes additional subdivisions connecting to Geschwind's territory of the parietal lobe.\autocite{Catani2005,Martino2013a}

\subsection{Inferior fronto-occipital fasciculus}

% \paragraph*{Anatomy and function}

\begin{SCfigure}[][htb!]
  \includegraphics[width=0.5\textwidth]{chapter_2/ifof_schema.jpg}
  \caption{\note{draft} Scematic of arcuate fasciculus, from \textcite{Geschwind1970}}
  \label{fig:ifof}
\end{SCfigure}

Even compared to the arcuate fasciculus, whose canonical description, however since disputed, was at least anchored in a strongly motivated connection between two well described cortical regions and an attached clear linguistic function, study of a direct white matter fibre connection between the occipital and frontal lobes has an unsettled history.\autocite{Forkel2014a}
Thanks to a confusing mix of attempting to directly compare simian and human anatomy,\autocite{Schmahmann2007,ThiebautdeSchotten2012,Mandonnet2018,Sarubbo2019} the historical study of and extrapolation from atypically developed or lesioned brains,\autocite{Schmahmann2007,Forkel2014a} and the difficulty by any means of following long-range connections in the brain,
\autocite{Martino2010} the \gls{ifof} is an exceedingly difficult tract to pin down from available literature.\autocite{Sarubbo2019,Weiller2021}

The most widely cited functional role of the \gls{ifof} is one of semantic processing and fluency as part of the wider language network, supported by lesion studies\autocite{Ille2018b,Almairac2015} and the eliciting of semantic paraphasia by \gls{des} along its entire course,\autocite{Duffau2013a,Herbet2017,Voets2017,Vigren2020a} while the connections to the occipital lobes point more specifically to lexical and visual-semantic involvement.
\autocite{Martino2010,Rollans2017,Rollans2018}
From a surgical perspective, damage to and infiltration of the \gls{ifof} has been associated with transient or permanent semantic deficits and is commonly dislocated or infiltrated by tumours. \autocite{Almairac2015,Voets2017,Altieri2019,Binding2023}
Situated within the temporal lobe alongside the \gls{or} and the dense language association network, the \gls{ifof} is at risk of injury in temporal lobectomy surgeries common in the treatment of epilepsy. \autocite{Baran2020,Shah2022,Binding2023}
Furthermore, \textcite{Bello2010d} found preoperative reconstruction of the \gls{ifof} from \gls{dmri} to be in strong agreement with intraoperative functional mapping with \gls{des}.

The \gls{ifof} is frequently described as the key pathway underpinning a proposed ventral stream of language processing\autocite{Duffau2013a,Rollans2018,Voets2017,DavidPoeppel2012} (inspired by the dual-stream ``what" and ``where" model of visual processing), even though early works on this dual-stream framework for language make practically no mention of the occipital cortex.\autocite{Hickok2004,DavidPoeppel2012,Kummerer2013}
Others conflate it with the ``extreme capsule fibre system"\autocite{Friederici2013a,Zhang2018} (analogous to the structure described in non-human primates\autocite{Mandonnet2018,ThiebautdeSchotten2012}), said to connect the temporal and frontal cortices,\autocite{Kummerer2013}
or otherwise declare the \gls{ifof}'s origins as being, at least partly, in the temporal lobe.\autocite{Bajada2015a}
This casual blurring of functional and anatomical postulation and evidence has lead to a fair degree of uncertainty surrounding the cortical, in particular the posterior,\autocite{Martino2010,Forkel2014a,Weiller2021} terminations of the \gls{ifof} and how it ties in with the wider models of cerebral language networks.
\autocite{Duffau2013a, Mandonnet2018, Rollans2018, Friederici2013a}
The cognitive functions residing in the frontal cortex are often nebulously defined and difficult to study and pin down, making the anatomical definition of pathways associated with those functions correspondingly difficult.
Beyond the commonly cited semantic functional role, researchers have also speculated, often based on at best tenuous evidence, on roles for the \gls{ifof} that include reading and writing functions associated with parts of the parietal cortex,\autocite{Motomura2014} sensorimotor processing\autocite{Martino2010} and planning,\autocite{Sarubbo2013} and involvement in goal-oriented behaviour.\autocite{Conner2018}
% tenuous because e.g. Sarubbo2013 is referring to Rizzolatti and Matelli 2003 which actually is only talking about the dorsal visual stream in monkeys? and no mention of IFOF? and Conner because the goal oriented behaviour ref is a review of DTI studies.
\textcite{Sarubbo2013}, \textcite{Martino2010}, and \textcite{Rollans2018}, considering terminations in the parietal lobe in addition to occipital regions, have all proposed possible subdivisions of the IFOF into language and non-language related functions.
% \paragraph*{Posterior terminations}

We will look for an anatomical consensus among post-mortem dissection studies aimed at uncovering the anatomical path of the \gls{ifof}, considering first the posterior and subsequently the frontal terminations.
In their detailed dissection studies, \textcite{Martino2010}, and \textcite{Sarubbo2013} all confirmed the extrastriate occipital cortex, in particular the middle occipital gyrus, as primary posterior targets, while lateral occipital lobe terminations were also studied in \textcite{Palejwala2020}.
% \textcite{Hau2016} agree as-well, however that study was based on tractography alone and therefore difficult to trust when it comes to detailed distinction of cortical terminations.
In addition to the largely agreed upon occipital regions, additional terminations have been found in the parietal and temporal cortices, in particular the superior parietal lobe, fusiform and inferior temporal gyri in \textcite{Martino2010}, and the lingual gyrus in \textcite{Sarubbo2013}.
The lingual gyrus and cuneus are cited as IFOF origination regions in \textcite{Palejwala2021}
However, it must be pointed out that the \gls{ifof} fibres have not been unambiguously distinguished from other parietal-occipital bundles, including the \gls{or} and temporal association tracts.
For example, the lingual gyrus is cited in \textcite{Sarubbo2013} as one of three ``main apparent origins" of the IFOF, albeit to a limited extent, while \textcite{Martino2010} asserted that any fibres connected to the lingual gyrus belonged to the optic radiations.
% (\textcite{Hau2016} reported tractography projections to the lingual gyrus ``in almost all subjects".)

After coursing through the temporal lobe above the roof of the temporal horn,\autocite{Martino2010,Kljajevic2014a} the \gls{ifof} converges into a narrow bundle to squeeze, alongside the \gls{uf}, through the temporal stem and into the frontal lobe (Fig. \ref{fig:ifof}).\autocite{Martino2010,Sarubbo2013}
\textcite{Martino2010} maintained that ``at the level of the frontal operculum, the fibers of the IFOF strongly intersect with the terminal branches of other long association fasciculus", making dissection extremely difficult, and indeed not possible for that particular study.
Nevertheless, \textcite{Sarubbo2013} have conducted the only dissection study to my knowledge analysing in detail of the frontal connections specifically of the IFOF.
Other studies, e.g. \textcite{Burks2017}, focus on a particular cortical region and study all connections to the region.
The disadvantage with such studies is in the aforementioned difficulty of simultaneously keeping the fibres of multiple bundles intact and traceable at once.
Connections to the inferior frontal gyrus, the seat of Broca's area, were confirmed in \textcite{Sarubbo2013} as well as \textcite{Hau2016}, and are consistent with a linguistic function.
\textcite{Sarubbo2013} also found terminations in the middle frontal gyrus (and more specifically the dorsolateral prefrontal cortex) ``in all specimens".
Finally, the orbitofrontal cortex, which is considered to play an important role in decision making, and frontal pole terminations were found in \textcite{Sarubbo2013} as well as in \textcite{Burks2017}.

Taken together, the dissection studies confirm (i.e. reported in all or most specimens) primarily posterior terminations in the superior, middle, and inferior occipital gyri and anterior terminations in the middle and inferior frontal gyri, frontal pole, and orbito-frontal cortex.
The evidence is less clear for wider connections to the parietal, posterior temporal and superior frontal cortices, so these will be excluded from the tractfinder atlas.
Streamlines were seeded in the temporal stem (extreme capsule) and selected according to cortical targets derived from the Freesurfer (v4.5) Destrieux atlas\autocite{Destrieux2010} (2009 version) parcellation.\footnote{frontal labels: 1\{1,2\}1\{01,05,15,54,12,13,14,53,63,24,65\}; occipital labels: 1\{1,2\}1\{02,19,20,58,59\}}

\section{Streamline tractography and filtering}

A dataset of \gls{hardi} acquisitions from 16 healthy adult volunteers (``EEG, fMRI and NODDI dataset",\autocite{Clayden2020} available online at osf.io/94c5t) was used in the creation of reference bundles for developing the atlas.
\Gls{dmri} scans were acquired at 2.5mm isotropic voxel size with three shells at $b=2400s/mm^2$ (60 directions), $b=800/mm^2$ (30 directions), $b=300/mm^2$ (9 directions), and a single $b_0$ image with no diffusion weighting.
In addition, a high resolution anatomical T1-weighted scan with 1mm isotropic voxel size was acquired in each subject.
 % Finally, we target a total of 109 measurements to have a total acquisition time of around 16 minutes. The optimisation divides the measurements into three HARDI shells with b = 2400 s mm-2 (60 noncollinear gradient directions and six b = 0 images), b = 800 s mm-2 (30 noncollinear gradient directions and three b = 0 images) and b = 300 s mm-2 (9 noncollinear gradient directions and one b = 0 image). These were acquired with a voxel matrix of 96 x 96, 60 contiguous axial slices, each 2.5 mm thick, FOV 240 x 240 x 150 mm, voxel size of 2.5 x 2.5 x 2.5 mm and TR/TE 8300/98 ms.
 % High resolution T1-weighted whole-brain structural images were also obtained in both sessions, with a voxel size of 1.0 x 1.0 x 1.0 mm, TR/TE 11/4.94 ms, flip angle 15 degrees, FOV 256 x 256 x 256 mm, voxel matrix 176 x 216 and 256 contiguous slices. The mean interscan interval was 35 +/- 41.6 days.
The \gls{dmri} was preprocessed to remove noise, bias field, susceptibility distortions and motion artefacts using tools provided by the MRtrix3 (v3.0\_RC3) and FMRIB (v6.0.5) software libraries.
\gls{fod} images where produced using multi-shell multi-tissue \gls{csd}\autocite{Jeurissen2014,Tournier2019} and response functions estimated using the Dhollander algorithm.\autocite{Dhollander2016}
Then each bundle of interest was reconstructed in both hemispheres using probabilistic streamline tractography with iFOD2 \autocite{Tournier2010} and an ROI strategy based on anatomical landmarks as described above. (See \ref{app:rois} for full details.)

After streamline generation, each streamline bundle was transformed into MNI space using affine registration implemented in FMRIB's Linear Image Registration Tool\autocite{Jenkinson2002} between the subject's T1-weighted image and the MNI152 T1 template.\autocite{Fonov2011}
Affine registration rather than non-linear, was used for this step to capture individual anatomical variation and minimise unrealistic warping of streamlines from local registration errors or overfitting.
With all subject streamlines aggregated in MNI space, manual filtering of streamlines was performed (Fig. \note{fig:atlases}) to remove not only ``volumetric false positives", which depart from the accepted volume of the tract, but also ``orientational false positives" (OFPs), which remain entirely within the tract volume but are at least in part aligned with a different, intersecting bundle.
An example of such OFPs are depicted in Figure \ref{fig:ofp}. Such streamlines have little effect on any volumetric applications of the reconstruction, e.g. via a track density depiction.
However, their removal is vital for the construction of the orientation atlas, which summarises the orientational distribution of streamlines on a voxel-wise basis.
Filtering was performed in DSI studio (v2021\_04, \url{https://dsi-studio.labsolver.org/})\autocite{Yeh2021a}, which enables the filtering of streamlines based on angle of intersection with a cutting plane.

\begin{figure}[htb!]
  \centering
  \begin{subfigure}{0.3\textwidth}
    \includegraphics[width=\textwidth]{chapter_2/OFPs1.png}
  \end{subfigure}%
  \begin{subfigure}{0.3\textwidth}
    \includegraphics[width=\textwidth]{chapter_2/cst_tod_unfiltered.png}
  \end{subfigure}%
  \begin{subfigure}{0.3\textwidth}
    \includegraphics[width=\textwidth]{chapter_2/cst_tod_filtered.png}
  \end{subfigure}%
  \caption{Example orientational false positive streamlines, isolated from a \gls{cst} bundle (left).
  View is from a superior vantage. Ascending streamlines following the CST abruptly turn along an anterior-posterior direction to follow the course of the intersecting superior longitudinal fasciculus, before again turning back towards the motor cortex.
  Atlas \glspl{tod} without (middle) and after (right) filtering out OFPs.}
  \label{fig:ofps}
\end{figure}

The percentage of streamlines filtered for each tract and summarised reasons for removal are presented in Table \ref{tab:filt}.
What is immediately apparent is the large discrepancy between tracts in the number of streamlines filtered, an indication of how much easier it is to reconstruct some tracts over others.
For the \gls{cst}, thanks to the well targeted cortical seeding and structurally highly distinct pathway, it was only necessary to remove a small percentage of streamlines, mostly OFPs in the centrum semiovale.
By contrast, approximately half of all \gls{ifof} streamlines were discarded, due thanks to the tight association of multiple tracts in the \gls{ss} resulting in overwhelming contamination from abutting structures, in particular the \gls{vof}.
The absolute number of retained streamlines is of little consequence to subsequent steps in creating the atlas, after ensuring full coverage of the tract in every training subject.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table*}[t]
  \caption{Streamline filtering statistics. Abbreviations: \acrolist{af,crp,cc,cst,ec,slf,sfof,vof}}
  \label{tab:filt}
  \small
  \begin{tabularx}{\textwidth}{llllll X}\toprule
   &  & Original & Filtered & Difference & Reduction & Reasons for discarding \\
   \midrule
  CST & left & 148833 & 145300 & 3533 & 2.37\% & \multirow{3}{=}{Contamination from: AF / SLF, SFOF, CC, CrP} \\
   & right & 144759 & 139019 & 5740 & 3.97\% &  \\
   & total & 293592 & 284319 & 9273 & 3.16\% &  \\ \addlinespace
  AF & left & 61922 & 49778 & 12144 & 19.61\% & \multirow{3}{=}{Contamination from:  EC, CST, CC Overextension into: Motor, anterior temporal, and superior frontal cortex} \\
   & right & 61834 & 43027 & 18807 & 30.42\% &  \\
   & total & 123756 & 92805 & 30951 & 25.01\% &  \\ \addlinespace
  OR & left & 123842 & 99984 & 23858 & 19.26\% & \multirow{3}{=}{Contamination from: Tapetum of CC, SLF} \\
   & right & 122534 & 109265 & 13269 & 10.83\% &  \\
   & total & 246376 & 209249 & 37127 & 15.07\% & \\ \addlinespace
  IFOF & left & 80000 & 44224 & 35776 & 44.72\% & \multirow{3}{=}{Contamination from: Tapetum of CC, VOF, superior frontal cortex} \\
   & right & 80000 & 31753 & 48247 & 60.31\% &  \\
   & total & 160000 & 75977 & 84023 & 52.51 \% & \\ \toprule
 \end{tabularx}
\end{table*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{TOD mapping}

After aggregate filtering, the retained streamlines were re-separated into individual subject bundles and the \gls{tod} was computed from the individual bundles as described in \textcite{Dhollander2014} and implemented in MRtrix3. \autocite{Tournier2019}
\gls{tod} mapping is the generalisation of track density imaging into the angular domain, creating a 5D spatio-angular representation of streamline tracks on a voxel-wise basis.
The \gls{tod} image is represented in modified \gls{sh} basis \autocite{Descoteaux2006} using only even orders up to a maximum order $l_{max}=8$, meaning each image consists of 45 coefficients, denoted $t_j$, per voxel.
The distribution is described by those coefficients and the modified \gls{sh} basis functions $Y_{l,m}$ \autocite{Descoteaux2006} as

\begin{align}
  T(\theta, \phi) = \sum_{l=0}^{l_{max}} \sum_{m=-l}^l t_{l,m} Y_{l,m}(\theta, \phi) = \sum_j t_jY_j(\theta, \phi)
\end{align}

The individual \gls{tod} images at this stage still contain significant density bias, with exaggerated differences in magnitude between the core bundle portions and fanning extremities owing to tractography's tendency towards early termination outside of the densest collinear tract regions.\autocite{Smith2013,Calamante2015,Rheault2020}
The purpose of the atlas is to capture only the likelihood of a tract's presence in any given voxel (spatial prior) and, in the case that it is present, its expected orientation (orientational prior).
If the spatial prior is to be determined by considering the spatial variation of the tract between subjects, then the only information needed for each individual subject is a binary visitation map for the bundle and orientational data.
Thus to remove the streamline density component, the \gls{tod} maps for each subject are normalised.
The spherical integral of each \gls{sh} basis function $Y_{l,m}$ is

\begin{align}
  \int_{\Omega} Y^m_l(\theta, \phi) = \begin{cases}
   \sqrt{4\pi} & \text{ if } l=m=0\\
   0 & \text{ otherwise. }
  \end{cases}
\end{align}

Using the sum and constant rules of integration, the spherical integral of $T(\theta,\phi)$ is
\begin{align}
  \int_{\Omega} T(\theta,\phi) = t_0 \sqrt{4\pi}
\end{align}

where $t_0$ is the first \gls{sh} coefficient for $l=m=0$. Thus to remove density information the \gls{tod} map is normalised to unit integral as

\begin{align}
  \widetilde{T}(\theta, \phi) = \frac{T(\theta,\phi)}{\sqrt{4\pi} t_0}
\end{align}

After each individual \gls{tod} map has been normalised in MNI space, what remains contains only information about the tract's streamline orientations, and none about the number of streamlines passing through a given voxel in the original reconstruction.

Finally, the mean of all individual normalised \gls{tod} maps is computed to produce the final population tract \gls{tod} atlas.
Averaging all maps results in distributions that reflect all possible ranges of tract orientations in each voxel (Fig. \note{fig:mean}), while the first \gls{sh} coefficient of the atlas will reflect the proportion of training subjects in which the tract was present in a given voxel.
Outlier voxels visited by streamlines in only a single subject's reconstruction will contribute little weight to the final atlas.
This atlas can then be registered to a target subject for further processing.
Atlases have so far been created for the most commonly indicated pathways in neurosurgical planning and guidance, namely the \gls{cst}, \gls{af}, \gls{or} and \gls{ifof} (Fig. \note{fig:atlases}), with the creation of further atlases to be the subject of future work.
Users can also generate custom atlases from any set of training streamlines using the code available at \url{https://github.com/fionaEyoung/tractfinder}. \note{how to mention code?}

% \section{Discussion}
%
% \note{Consider different elements of the atlas construction, e.g. what is the effect (smoothing) of using only non-linear registration and possibly put the discussion on number of training subjects here too?}
