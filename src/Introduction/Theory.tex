\chapter{Neuroanatomy}
\label{chap:neuroanatomy}

\section{Cells of the brain}

The building blocks of living complex organisms begin at the level of molecules and atoms, through macromolecules such as proteins and lipids, organelles, cells, tissues, organs and finally whole organisms.
For the purposes of this thesis, we can start at the cellular level and focus on a single organ:
The brain, which, together with the spinal cord, forms the \gls{cns}.
Brain tissues comprise numerous cell types.
The principal functional cell of the human nervous system is the neuron, which performs the integration and transmission of electrical signals underpinning all aspects of neural function.
It wasn't until the work of Santiago Ram√≥n y Cajal (1852--1934), utilising the silver staining technique developed by Camillo Golgi (1843--1926) to meticulously draw and label neural cells, that the nervous system was recognised as comprising discrete signalling units which interface with one another only at specific points, a principle called the \textit{neuron doctrine}\autocite{Kandel2021a}.
The brain's approximately 80 billion neurons are supported by a network of glial cells of equal number and importance\autocite{Herculano-Houzel2014,vonBartheld2016}, and of which there are several specialised subtypes.

Neurons fulfil a wide spectrum of specialised functions across the nervous system, but all have the following basic components.
The cell body, or soma, houses the cell nucleus, metabolic activity and organelles responsible for the day-to-day upkeep and maintenance of the entire cell (Fig. \ref{fig:neuron}).
Neurons receive signal inputs from other neurons via one (uni- and bipolar neurons) or multiple (multipolar neurons) protrusions called dendrites.
Most neurons of the \gls{cns} possess a large number of dendritic processes, forming a beautiful dendritic tree collecting countless inputs.
Output signals are sent via a single, specialised protrusion called an axon, which can extend across great distances to deliver impulses to their targets.
Axon terminals interface with the dendrites of other neurons or, in the \gls{pns}, with muscles and other innervated tissues, at points of contact called synapses.
The speed of signal conduction in some axons, including those that travel great distances, is enhanced through sheaths of a fatty substance called myelin which provide electrical insulation.

Glial cells (from Greek \textit{glia}, ``glue") are the other major class of nervous system residents, and though long thought to outnumber neurons up to ten fold, newer evidence indicates that they are more or less equally numerous as neurons throughout the brain as a whole, although local ratios vary greatly\autocite{Herculano-Houzel2014}.
Astrocytes are supportive glial cells providing a range of services including phagocytosis, scar tissue formation and \gls{bbb} formation, the latter being a protective layer around neural vasculature selectively regulating molecular exchange between the bloodstream and brain parenchyma.
Oligodendrocytes are the \gls{cns}'s myelinating glia.
They form processes which wrap around axons as myelin sheaths, with each oligodendrocyte able to myelinate multiple axons simultaneously.
In the \gls{pns}, myelination is performed by Schwann cells, which each form a single myelin sheath.
Alongside these three classes of macroglia are the microglia, the resident immunological cells of the \gls{cns}, which patrol the brain for pathogens and clean up waste.

\begin{figure}[hbt!]
  \centering
  \includesvg[width=0.7\textwidth,pretex=\ttfamily\small]{chapter_1/neuron.svg}
  \caption{A neuron receives inputs across its dendritic tree (d) which converge on the cell body (c). Action potentials propagate down the axon (a) to the axon terminals (t) where they trigger chemical transmission of the signal at the synapses (s). Electrical conduction is accelerated by insulating myelin sheaths (m) separated by the nodes of Ranvier (n).}
  \label{fig:neuron}
\end{figure}

\section{Neural signalling}

Transmission of information in the brain is both electrical and chemical.
Neural impulses begin their life at the axon hillock, the transition between the soma and the axon.
At resting state, an electrical potential exists across the axonal membrane, resulting from separation of charges between the extra- and intra-axonal spaces.
This membrane potential arises from non-equal concentrations of different ionic species on opposite sides of the membrane, and is maintained by a combination of active ion pumps and passive ion channels embedded within the membrane, through which potassium (K$^+$), sodium (Na$^+$), and chloride (Cl$^-$) ions continuously diffuse or are actively transported across the membrane.
The interacting chemical and electrical potentials of primarily these ions, together with the concentration of ion channels selective for each species, give rise to a cell's resting potential, a steady net separation in charge maintained by a balanced flux of ions.
All neural signalling is both initiated and propagated by disturbances to this resting potential, when large changes to the membrane's selective permeability cause significant fluxes of ions to change the net charge separation.
When the membrane potential at the axon hillock is depolarised enough to reach a threshold, voltage-gated ion channels open to allow ions to flood across the membrane.

Each ion species experiences an interplay of the overall charge potential and its own chemical gradient:
At rest, Na$^+$ concentration is much higher outside the cell, while K$^+$ concentration is higher inside the cell, with those chemical gradients maintained by the relative membrane permeability to each species.
At the beginning of an axonal impulse the opening of voltage-sensitive sodium ion channels suddenly increases the membrane permeability to Na$^+$, allowing it to flow into the cell down its concentration gradient and further depolarise the membrane.
As nearby voltage-gated channels are triggered in turn, a wave of depolarisation propagating down the axon as an action potential.
After a brief delay, voltage-gated K$^+$ also activate, allowing potassium to repolarise the membrane by flowing down its own chemical gradient, out of the cell.
This rapid sequence of de- and repolarisation lasts only milliseconds, after which the membrane is again susceptible to excitation.
In myelinated axons, propagation of the action potential is greatly accelerated by the insulating effects of myelin sheaths, separated only by the narrow myelin-free nodes of Ranvier.
Myelin acts to decrease the membrane capacitance and thus increase conduction velocity down the axon, while the signal is periodically replenished by strong depolarising Na$^+$ currents at the nodes of Ranvier where voltage-gated Na$^+$ channel density is high.
Instead of the axon membrane depolarising in a continuous wave, the signal appears to ``jump" from node to node.
In myelinated axons, action potentials travel at speeds of up to 120~m~s${-1}$ depending on axon diameter, compared with up to 2~m~s${-1}$ in unmyelinated axons.

Upon reaching the axon terminal and synapse, the signal is converted from electrical to chemical.
The arrival of the action potential triggers the release of signalling molecules called neurotransmitters, which diffuse across the synaptic cleft and ligase with receptors in the postsynaptic cell to influence its membrane potential.
The effect on the target neuron depends on the neurotransmitter:
It may induce hyperpolarisation, in effect an inhibitory signal which decreases the likelihood of the target cell firing itself, or depolarisation, which brings the target cell closer to firing threshold.
Axons may branch to synapse with many targets, and each neuron may itself receive thousands of synaptic inputs across its dendritic tree.
Each impulse cases a slight de- or hyperpolarisation of the membrane, which diffuses towards the soma and axon hillock.
It's the cumulative effects of all those impulses that determine whether a neuron fires, transmitting a new action potential down its axon.

\section{Macroscopic neuroanatomy}

The human brain is divided macroscopically into the hind-, mid- and forebrain, which are densely interconnected via a system of axon fibre bundles (``tracts").
With reference to a particular brain structure or functional hub, incoming connections from other parts of the brain or spinal cord are called \textit{afferent}, compared to outgoing \textit{efferent} fibres.
The hind brain comprises the caudal brainstem (medulla and pons) and cerebellum (Figs. \ref{fig:anat1}--\ref{fig:anat2}).
The former forms a continuum between the forebrain to the spinal cord and houses control centres for vital, involuntary physiological functions and the cranial nerves.
Posterior to the brainstem, and seated within the posterior fossa, sits the cerebellum (``little brain"),
a highly specialised and complex structure whose full significance to cerebral function is yet to be fully described, but which is known to play an integral role in automated motor and speech functions.
The cerebellum connects with the pons and brainstem via three \gls{wm} bundles, the inferior, middle and superior cerebellar peduncles, of which the middle is the largest.
The pons also houses a dense arrangement of nuclei and tracts, connecting and integrating functions of the forebrain and cerebellum.

\begin{SCfigure}[][h!]
  \includesvg[width=0.6\textwidth,pretex=\sffamily\footnotesize]{chapter_1/anat_gross.svg}
  \caption{Macroscale subdivisions of the human brain. Adapted from \textcite{Carter1918}, Public domain, via Wikimedia Commons.}
  \label{fig:anat1}
\end{SCfigure}

The forebrain consists of the diencephalon (thalamus and hypothalamus) and the telencephalon (cerebral hemispheres).
Central both in importance and in location, the thalamus forms the gateway through which almost all afferent inputs to the forebrain are channeled.
Its cluster of nuclei relay sensory inputs to their relevant cortical regions, and project diffusely to all regions of the cortex to regulate, it is thought, widespread arousal and attention, and form a feedback loop for sensory and motor integration.
Ventral to the thalamus sits the hypothalamus, a centre for endocrine and metabolic regulation.

Evolutionarily speaking, the cerebral hemispheres are the youngest developments, responsible for much of the complex neural functionality we associated with the general intelligence of modern humans, as well as memory, sensorimotor control, and personality.
The surface of the cerebral hemispheres, called the cortex, is the site of integration of neural signals and complex neural computation, and is divided into the frontal, parietal, occipital and temporal lobes (Fig. \ref{fig:anat1}).
Cortical tissue consists of dense layers of neural somata, dendrites, interneurons, all locally connected by unmyelinated axons.
So extensive is the cortical surface in the human brain that, in order to fit inside the skull, it develops a folded topography of ridges (gyri) and valleys (sulci) which form distinctive landmarks on its surface which are recognisable between individuals.

At the heart of the brain flows a network of ventricles filled with \gls{csf}, a protective and supportive fluid which surrounds the \gls{cns}, providing cushioning and maintaining homeostasis\autocite{Wichmann2022}.
Two lateral ventricles curve through each hemisphere, connecting with the third ventricle separating the thalami at the midline, which in turn adjoins the fourth ventricle, a triangular cavity between the midbrain and cerebellum.
From there, \gls{csf} flows into the spaces surrounding the brain and spinal cord.

\begin{figure}[h!]
  \begin{subfigure}[b]{0.5\textwidth}
    \includesvg[width=\textwidth,pretex=\ttfamily\small]{chapter_1/arnold1838bd1_0040_TABVII.svg}
    \caption{Tabula VII, Fig. 1}\label{fig:ardnoldVII1}
  \end{subfigure}%
  \begin{subfigure}[b]{0.5\textwidth}
    \includesvg[width=\textwidth,pretex=\ttfamily\small]{chapter_1/arnold1838bd1_0046_TABX.svg}
    \caption{Tabula X, Fig. 4}\label{fig:ardnoldX4}
  \end{subfigure}
  \caption{Anatomical landmarks of the human brain, labelled on illustrations by Friedrich Arnold\autocite{Arnold1838}. a. spinal cord, b. medulla, c. pons, d. midbrain, e. cerebellum, f. hypothalamus, g. thalamus, h. lateral ventricle, i. third ventricle, j. fourth ventricle, k. subcortical white matter, l. cortical grey matter, m. corpus callosum, F. frontal lobe, P. parietal lobe, O. occipital lobe, T. temporal lobe, S. central sulcus}
  \label{fig:anat2}
\end{figure}


\section{Functional organisation: From topology to hodology}\label{sec:hodology}

Since antiquity scientists have suspected that different cognitive functions, rather than being equally distributed throughout the brain, arise from distinct locations.
While early incarnations of this idea may have featured wildly unfounded and mistaken conclusions regarding the functions that can be ascribed to specific localities, the underlying principle of functional localisation has been subsequently borne out and continuously refined.

The earliest theories focussed on the ventricles as the centres of cognition, before attention shifted to the cortex\autocite{Folzenlogen2019}.
Physicians of the 18th and 19th centuries popularised the study of bumps and dips on the skull as a means for assessing myriad character traits and capabilities, a pseudoscience known as phrenology.
Significant advances in the theory of functional localisation came with the seminal studies of aphasia, or disorders of language function, undertaken by Pierre Paul Broca (1824--1880) and Carl Wernicke (1848--1905).
Each gave their names to regions of the frontal and temporal cortex respectively, after consistently linking specific patterns of aphasia with lesions caused by stroke or injury to those regions.
Historically, much of the understanding of the functions seated in a given cortical region was in this way predicated on case studies involving injury (e.g. through trauma or stroke) to that region.
This resulted in inevitably imperfect understanding of the affected areas and functions, given that such random injuries are unlikely to precisely take out one isolated functional centre.
Modern non-invasive imaging and measuring techniques have accelerated our study of the brain, however clinical case studies remain significant contributors to the field.

Some cortical regions have been studied and mapped extensively, particularly those associated with easily measured quantities such as external stimuli and motor outputs.
Consequently, the organisation of the visual, motor, auditory and somatosensory cortices have been comprehensively described.
The precise localisation of high-level functions, on the other hand, such as advanced language, memory, planning, and personality remains elusive, not least because such complex multifaceted phenomena are unlikely to be associated with just a single structural-functional unit\autocite{Catani2007}.
Indeed, modern neuroscience understands that even seemingly primitive functions, such as visual object identification, involve the integration of information and processing across multiple, often distant cortical loci\autocite{ffytche2005}, and thus there can be no complete understanding of any cognitive function by considering only demarcated cortical areas in isolation: the brain is a network, and the unit of connection between nodes is the neural axon.

Medium and long range connecting axons project from the cortex into a dense subcortical network, named ``white matter" after the pale appearance given by the abundance of insulating myelin.
White matter axons, rather than existing in an unordered tangle, form coherent bundles, or tracts, of fibres connecting similar brain regions.
There are three categories of white matter tracts:
Projection tracts connect the cortex with other, non-cortical brain structures and the spinal cord.
They include both efferent (motor) and afferent (sensory) connections.
Association tracts connect different cortical regions within the same cerebral hemisphere, while commissural tracts form interhemispheric connections.
The major commissural bundle is the corpus callosum, forming a thick band bridging the largely separated cerebral hemispheres (Fig. \ref{fig:anat2}).

While the division of white matter into individually described tracts introduces a certain level of clarity to the intricate brain network and a common ground from which to study it, many of their anatomical and functional definitions are far from clear-cut.
As we saw in the context of cortical functional localisation, the projection tracts, which have clear physiological correlates of sensory input and motor outputs, are relatively easy to study and have been correspondingly well defined.
Examples include the corticospinal tract, responsible for much of voluntary motor control, and the optic radiations, which bring visual inputs to the primary visual cortex in the occipital lobes, although as we will see in chapter \ref{chap:atlas} even these structures' exact courses can be called into question.

Meanwhile, the task of precisely delineating and ascribing functional correlates to the many association tracts is monumental and woefully incomplete.
Fibres from different tracts cross, mingle, and converge throughout the brain, and while fibres of the same tract may form a coherent bundle in deep white matter, they proceed to diverge and fan out, terminating in broad swathes of cortex.
In this way, fibre tracts form fractal echos of their individual neural constituents, drawing on many inputs to disseminate the output signals across countless targets.
There is no perfect method for observing the full extent of a tract from one end to another.
Postmortem dissection remains the gold standard for anatomical identification, but it is delicate work and disentangling the full course of one bundle of fibres from all other surrounding ones is impossible.
So it is that anatomical dissections have at times identified and defined tracts which turned out to be entirely artifactual.
In Chapter \ref{chap:atlas} we will further explore difficulties of defining white matter tracts.

Neuroscientists, anatomists, and neurologists have increasingly come to recognise the importance of looking beyond the purely localisationist models that focus on cortico-functional organisation, towards the integration of white matter connectivity into our understanding of cognitive function\autocite{ffytche2005,Catani2007}.
After all, the axons in white matter are extensions of the cells that make up grey matter, so there can be no activity of the latter that does not involve the former.
Indeed, far from being a mere philosophical question about under what framework we study and write about the brain, the so-called hodological view (from Greek \textit{hodos} ``path") has profound translational implications.
Traditional localisationist approaches to neurosurgery hold, crudely put, that tumours seated within or in close association to ``eloquent" areas of cortex subserving well studied functions of language, low-level sensory processing and movement, are fundamentally inoperable.
Meanwhile tumours in areas of ``non-eloquent" cortex with no known overt functional correlates can be radically resected with few substantial neurological consequences.
Much of the study into and tools for functional preservation of so-called eloquent areas that will be discussed in Chapter \ref{chap:neurosurgery} adopts this framing.
But the postoperative deterioration in neurocognitive function and quality of life often experienced by patients undergoing surgery for epilepsy or tumours in ``non-eloquent" areas flies in the face of such thinking.
\autocite{Satoer2017,Mandonnet2017a,Rijnen2019,Herbet2019,Vigren2020a,Dadario2021}
Furthermore, emerging evidence suggests adopting a hodological approach to neurosurgery can inform successful resection of tumours from areas typically considered inoperable\autocite{Dadario2021,DeBenedictis2011b,Suzuki2023}.

As frameworks of neural function continue to evolve alongside our technological means to study it, we find ourselves reaching across the disciplinary divides for tools and ideas with which to advance our understanding of the brain.
Modern neuroscience is blend of cognitive, systems, computational, psychological, anatomical and molecular domains, each influencing and adding context to the others.
As such, while the methodologies and experiments presented in the thesis are rooted in \textit{in vivo} structural imaging of individual white matter tracts, questions around functional tract definitions and surgical relevance will recur throughout.

\begin{figure}[hb!]
  \centering
  \includegraphics[width=0.6\textwidth]{chapter_1/xkcd_1163_debugger.png}
  \caption*{\href{xkcd \#1163: ``Debugger"}{https://xkcd.com/1163/}}
  \label{fig:xkcd}
\end{figure}

\chapter{MRI Physics}
\label{chap:NMR}

The study of living human neuroanatomy at the millimetre and macro scale in unprecedented detail was unlocked in the latter 20th century by the advent of \gls{mri} techniques.
To understand the workings of the ``Wonder Machine" (in the words of podcasters Josh Clark and Charles W. ``Chuck" Bryant), we have to leave behind our microscopic neurons and enter the realm of atomic and subatomic particles to cover the mechanisms of \gls{nmr}.
Throughout this section, vector quantities and their associated scalar magnitudes will be formatted as $\mathbf{a}$ and $a$ respectively.

\section{Nuclei and spin}

\Gls{nmr} is a phenomenon and a technique, in which the interactions between atomic nuclei and external magnetic fields produce characteristic electromagnetic signals.
Atomic nuclei are made up of protons and neutrons (collectively termed nucleons) held together, despite the electrostatic forces repelling the positively charged protons, by the nuclear force, or residual strong force.
The number of protons, or atomic number, in a nucleus determines the element: Every hydrogen atom has exactly one proton, every oxygen atom exactly eight, and so on.
A given element can have a variable number of neutrons, with the total number of nucleons determining the \textit{isotope} of that atom.
While \gls{nmr} applies to any atomic species with the appropriate quantum nuclear properties, the vast majority of \gls{mri} applied to human imaging concerns itself only with one:
The nucleus of a hydrogen atom which, in its most abundant isotope (protium, $^1$H), is a single, positively charged proton.

The particular combination of nucleons determines that nucleus' spin and quantum magnetic moment, properties which in turn determine the effects wrought by an external magnetic field on that nucleus.
Spin (or spin angular momentum) $\mathbf{S}$ is an intrinsic property of elemental particles, and of their composites, including nuclei\autocite{Eisberg1961}.\footnote[2]{The unique spin quantity of nuclei $I$ arises non-trivially from the interactions of its constituent nucleons' individual spins, however we are concerning ourselves here only with individual protons.}
Each particle has a fixed, dimensionless spin quantum number $s$ ($\frac{1}{2}$ for single electrons, protons and neutrons) which determines the spin vector's magnitude given by $S = \hslash \sqrt{s(s+1)}$, where $\hslash$ is the reduced Planck constant.
However, according to the uncertainty principle of quantum mechanics, which posits that the location and momentum of quantum system cannot be known simultaneously, the total spin angular momentum vector (magnitude \textit{and} direction) cannot be measured.
Instead, the associated observable quantity is the component of $S$ along the observed direction, typically arbitrarily designated the $z$-axis, which is determined by another quantum number $S_z = \hslash m_s$.
The spin magnetic quantum number $m_s$, like $s$, is a quantised property, meaning it can inhabit a discrete number $2s+1$ of values ranging from $-s$ to $+s$.
As a spin-$\frac{1}{2}$ particle, the proton thus has two possible spin states given by $m_s = \pm \frac{1}{2}$, commonly called ``spin-up" and ``spin-down".

The existence of an intrinsic angular momentum of a particle with electrical charge (i.e. a single electron, proton or nucleus) gives rise directly to another vector quantity, a magnetic moment $\bm{\mu}$.
Following directly the spin picture, the observable component $\mu_z$ is related to the spin angular momentum: $\mu_z = \gamma S_z = \gamma \hslash m_s $.
where $\gamma$ is the \textit{gyromagnetic ratio}, a species-specific quantity derived from its charge, mass and intrinsic $g$-factor.
Under quantum mechanics, a spin system can only inhabit a quantised set of possible states, called \textit{eigenstates} which have associated total energy \textit{eigenvalues}.
In the absence of an external magnetic field, the spin eigenstates $m_s = \pm \frac{1}{2}$ are degenerate, meaning their energies are equal and neither is more likely than the other, but they split into different energy levels in phenomenon called the Zeemann effect under the influence of an external magnetic field.
The ratio of spins in spin-up vs spin-down state is given by the Boltzmann distribution, which describes the expected value of the energy states over all possible quantum superpositions:
\begin{align}
  \frac{N_{\uparrow}}{N_{\downarrow}} = e^{\Delta E / k T} = e^{\gamma \hslash B / k T}, \label{eq:boltzmann}
\end{align}
where $\Delta E$ is the difference in energy between the two states and is proportional to the external field strength $B$.
The spin magnetic moments also precess about the external field in a phenomenon known as \textit{Larmor precession} at an angular frequency of
\begin{equation}
  \omega = \gamma B
\end{equation}

\begin{figure}
    \centering
    \includesvg[height=0.4\textwidth,pretex=\small\sffamily]{chapter_1/nmr.svg}\qquad%
    \includesvg[height=0.4\textwidth,pretex=\small\sffamily]{chapter_1/relaxation.svg}
  \caption{\gls{mri} depends on quantum interactions between nuclei and magnetic fields. \textbf{a.} Larmor precession of nucleus with spin magnetic moment $\bm{\mu}$ around external magnetic field $\mathbf{B}_0$. \textbf{b.} Immediately after 90\textdegree \gls{rf} excitation into the $xy$-plane, the bulk magnetisation $\mathbf{M}$ relaxes back to equilibrium where $\mathbf{M}_z=\mathbf{M}_0$ and $\mathbf{M}_{xy}=0$ in a spiral patter, inducing an oscillating electrical signal in the receiver equipment.}\label{fig:larmor}
\end{figure}

\section{Resonance and relaxation}

% \note{Basics of resonance, magnetisation, spin-spin / spin-lattice relaxation}
%
% \gls{mri} exploits the abundance of hydrogen atoms, bound to H$_2$O (water) molecules
%
% \gls{mri} images are obtained by detecting the spin relaxation resonance stuff of principally hydrogen atoms (which are abundant in the body in  molecules).

The application of a strong linear magnetic field $\mathbf{B}_0$ along $z$ causes spins in a sample to, on average, align themselves with the direction of that field, with the ratio of spins in each of the possible energy states determined by (\ref{eq:boltzmann}).
At equilibrium, more spins magnetic moments will occupy the lower energy state aligned with $\mathbf{B}_0$, resulting in a net bulk magnetisation $\mathbf{M}_z$ with magnitude $M_0$ at equilibrium.
As the difference in energy between the two states is determined by $\Delta E = \gamma h B_0$, the stronger the external field, the larger the ratio of up to down spins and thus the a larger $M_z$.
This in turn underpins the strength of any subsequently sampled signals, so that stronger $\mathbf{B}_0$ fields, as a general rule, produce images with better \gls{snr}.
Just as the distribution of spin states among two possible opposing states produces a net \textit{longitudinal} magnetisation along $z$, the lack of any directional coherence perpendicular to $z$ precludes any net \textit{transverse} magnetisation $\mathbf{M}_{xy}$.
In other words, at thermal equilibrium the magnetic moments within the sample are precessing at the Larmor frequency with random phases (Fig. \ref{fig:larmor}).

Manipulation of the net magnetisation away from, and subsequent relaxation back to this equilibrium state, is the basis of all signal production in \gls{mri}.
Spins in the lower energy state can be excited to occupy the higher energy state by absorbing electromagnetic radiation tuned precisely to the Larmor frequency.
This energy is transmitted in the form of an oscillating magnetic field $\mathbf{B}_1$, called a \gls{rf} pulse as the frequency falls within the \gls{rf} range of the electromagnetic spectrum, and has two effects on the bulk magnetisation.
The first is a reduction in $M_z$, as the absorbed energy reduces the ratio of spins in the relaxed state, with the total change in $M_z$ dependent on the duration $\tau$ of the \gls{rf} pulse.
Secondly, spins will align themselves with an effective field combining $\mathbf{B}_0$ and the rotating $\mathbf{B}_1$, resulting in a phase synchronisation of spins' precessions and a net, rotating transverse magnetisation $\mathbf{M}_{xy}$.
It is the sweep of this rotating bulk magnetisation vector which induces an oscillating current in the receiver equipment of the \gls{mri} scanner, which is registered as the signal called \gls{fid}.
The angle between the total magnetisation $\mathbf{M} = \mathbf{M}_{xy} + \mathbf{M}_{z}$ after the \gls{rf} pulse and $\mathbf{B}_0$ is the flip angle $\alpha$ determined by $\alpha = \gamma B_1 \tau$.

As soon as the excitation field is switched off, the bulk magnetisation gradually relaxes to equilibrium as the induced effects on the individual moments revert.
Interactions between spins and their molecular environment cause de-phasing of their precession and consequent reduction in $M_{xy}$ (spin-spin or transverse relaxation), while the energy gained from the \gls{rf} pulse is gradually thermally dissipated among the lattice of neighbouring molecules as the spins revert to the statistically favourable lower energy state in alignment with $B_0$ causing gradual recovery of $M_z$ (spin-lattice or longitudinal relaxation):

\begin{align}
  M_z(t)  &= M_0 (1-e^{-t/T_1}) \\
  M_{xy}(t) &= M_0 e^{-t/T_2} \label{eq:recovery}
\end{align}

where the recovery rate of $M_z$ and the rate of decay of $M_{xy}$ are described by the time constants $T_1$ and $T_2$ respectively, and each depend on the specific molecular environment and are thus tissue-dependent quantities.
It is the varying values of $T_1$ and $T_2$, as well as the overall differences in \glspl{pd} between tissues which lend contrast to MR images.

\section{Signal echos}\label{sec:echos}

Immediately after application of the \gls{rf} excitation pulse, magnetisation will return to equilibrium in a spiral pattern (Fig. \ref{fig:larmor}) inducing the rapidly decaying \gls{fid} signal.
Due in part to its short lifetime, the simple \gls{fid} is not particularly useful on its own for biological imaging.
In fact, the phase coherence of the system is not entirely lost even as the \gls{fid} signal reaches zero, but only masked by competing effects.
This hidden signal can be partially resurrected though the spin echo technique, but to appreciate how we must first look more closely at the transverse relaxation process, which is the result of a range of different effects through which spins lose their phase coherence.
One is an intrinsic tissue property, in which through interactions with the molecular environment spins experience minute perturbations in $\omega$ and accumulating phase differences as a result.
This dephasing is associated with the ``true" $T_2$.
In addition, in homogeneities in the applied $B_0$ field also produce slightly varying $\omega$ values across the sample, with the same dephasing effect.
The combination of intrinsic $T_2$ and the effects of field inhomogeneities produce an overall dephasing effect characterised by $T_2$*, where  $T_2$* $\leqslant$ $T_2$.

If, a time TE/2 after a 90\textdegree\ \gls{rf} pulse is applied to the sample, an additional ``refocussing" 180\textdegree\ pulse follows, $\textbf{M}$ will be flipped in the $xy$ plane.
Recall that variations in precession speeds will mean that some spins will have accumulated a certain amount of phase ``ahead" of the ensemble average, while others will lag behind.
After being flipped, while the speeds stay the same, the relative phase differences will be reversed, allowing the slower spins to catch up.
Thus after an additional symmetrical time span of TE/2, the uneven effects of field inhomogeneities will have been entirely cancelled out and the spins find themselves briefly rephased, producing a spin echo signal peak at TE (echo time).
The signal at echo peak is then only dependent on the intrinsic $T_2$, not on $T_2$*.

The need for an additional \gls{rf} pulse to produce a spin echo introduces instrumentation delay times and corresponding loss of signal magnitude.
An alternative form of signal echo is the gradient echo, which can work with shorted TEs and produce different types of image contrast.
To produce a gradient echo, a static, spatially varying magnetic field gradient $G_x$ is applied across the sample causing spins to precess at different rates according to their local magnetic field $B_0 + G_xx$ and dephase, spoiling the \gls{fid} more rapidly than it would decay on its own.
After a time TE/2 the gradient polarity is reversed, and with it the rates of dephasing across the sample.
Spins previously precessing fastest are now the slowest and vice versa, such that after an equal amount of time TE/2 under the reversed gradients the gradient-induced dephasing effects are reversed, producing a signal echo at TE.
Since the reversal of gradient polarity effects only the gradient coil generated fields, the dephasing caused by local inhomogeneities in the $B_0$ field cannot be reversed, and the resulting signal is $T_2$* weighted.

\section{Spatial encoding}

The signal induced in an \gls{mri} receiver coil is a complex superposition of contributions from spins located throughout the excited sample.
To generate a three dimensional image from this time-varying electrical current, the individual signal components need to be separated and attributed to positions in space.
Most commonly in medical imaging spatial encoding is achieved with the \gls{2dft} method using slice selection, phase encoding and frequency encoding\autocite{Hendee2002}.
In theory, these three encoding dimensions can apply to any permutation of the three spatial axes, but in practice, and for the purposes of this simplified description, it is easiest and conventional to select slices along the $z$-axis, parallel with the main magnetic field, and we will designate the $x$ and $y$ axes as the frequency and phase encoding dimensions respectively.

Slice selection ensures that the \gls{rf} pulse only excites a specific slab within the sample, and is achieved by overlaying a magnetic field gradient $G_s$ along the slice selecting dimension $z$, altering the Larmor frequencies of the spins along $z$ according to $\omega_0 + \gamma G_sz$, where $\omega_0 = \gamma B_0$ is the Larmor precession frequency under $\mathbf{B}_0$.
A \gls{rf} pulse with (central) frequency $\nu_c = \frac{1}{2\pi} (\omega_0 + \gamma G_s z_c)$ will induce resonance in spins located only at position $z_c$, producing a slice of excitation. %\note{the 2 pi thing is about converting from angular frequency?}
All other spins in the sample will be unaffected by subsequent manipulation of the magnetisation vector throughout the pulse sequence and will not generate signal.
The slice width $\Delta z$ is determined by the \gls{rf} pulse bandwidth $\Delta\nu$ as $\Delta z = \frac{2 \pi \Delta \nu}{\gamma G_s}$.

Within the selected plane, manipulation of two spin quantities determines localisation in the remaining two dimensions.
The first is spin precession frequency, which can be modulated along an axis in the same manner as is used in slice selection -- a \gls{fe} magnetic field gradient $G_{f}$ applied along $x$ imparts spatially varying frequencies according to $\omega_0 + \gamma G_{f}x$.
Thus each spin precesses at a frequency that uniquely identifies its position along the \gls{fe} direction.
In practice, frequencies are grouped into pixels of finite width, with the range of frequencies per pixel termed \textit{pixel bandwidth}, while the full range of frequencies (total receiver bandwidth) across the sample determines the image field of view (FOV) in the \gls{fe} direction.
The width of each pixel is determined by the analog-to-digital sampling rate of the received signal, such that if the signal is samples at dwell time intervals of $t_d$ for a total amount of time $t_s$, the total \gls{fe} bandwidth is $t_d^{-1}$ and the pixel bandwidth $t_s^{-1}$.
The frequency encoding gradient is applied throughout the signal readout period to maintain the spatially dependent frequencies and is correspondingly also called the readout gradient.
The receiver coil digitally samples the echo signal at discreet points, with the number of samples corresponding to the image matrix size along the $x$ axis.

The second encoded property is spin phase.
If differences in spin frequency can be likened to clocks running at different speeds, then two spins with different phases (but the same frequency) are like two clocks which both keep perfect time, except that one has not been set correctly and is perpetually five minutes behind the other (these two clocks would have a phase difference of five minutes).
For the two clocks running at different speeds, their phase difference would constantly change as one fell further and further behind the other.
Before signal readout, a \gls{pe} gradient $G_p$ is applied along $y$ imparting different precession frequencies as a function of $y$ as we saw for frequency encoding, with spins slowing acquiring growing phase differences according to their $y$ positions.
This can be likened to taking two clocks and moving one closer to a very large object, whose gravitational field will cause it to run slower and gradually fall behind the second clock.
After a time $\Delta t_p$, $G_p$ is switched off, and in its absence spins return to precessing at the same rates, except that they have accumulated $y$-dependent phase difference $\phi_p$ to the tune of $\phi_p=\gamma G_p y \Delta t_p$.
In other words, the clocks have been brought back together such that they keep the same time, but without correcting the five minute lag one clock accumulated while it was experiencing gravitational time dilation.
Since the phase encoding gradient is switched off before signal readout, phase differences become locked in and serve to identify spins along the \gls{pe} direction.
A single echo provides insufficient information to fully separate out the mixed phase contributions and uniquely determine the $y$ coordinates of received signal components.
Instead, the excitation--phase-encoding--echo-readout sequence is repeated with varying \gls{pe} strengths resulting in a series of echo train signals, with the number of \gls{pe} steps $N_{p}$ corresponding to the image matrix size along the $y$ axis.

After all \gls{pe} steps have been acquired, the full data from a single slice has been recorded as a series of time-varying electrical signals.
Thanks to our spatial encoding gradients, we know that those signals are complex mixtures of frequencies originating from different positions in the sample.
The spatial frequencies and phases in this raw signal can be represented in the 2-dimensional frame known as $k$-space, a reciprocal space defined as the inverse spatial \gls{2dft} of the measured image.
To reconstruct an image in the spatial domain, two Fourier transforms are computed, first for each signal train, and secondly for each time sample across all phase encoding steps.

\begin{figure}
  \includesvg[width=\textwidth,pretex=\sffamily\small]{chapter_1/kspace_axial.svg}
  \caption{Sampled MR signals encode 2D images. \textbf{a.} A single echo train is sampled at dwell time intervals $t_d$, where each sample corresponds to a point in reciprocal $k$-space, and $t_d$ determines the frequency resolution along $k_x$ and the image matrix size along $x$. \textbf{b.} Repeated echos with varying \gls{pe} gradient strengths sample the image along $k_y$. \textbf{c--d.} The image in spatial dimensions is reconstructed by taking the 2D \gls{ft} of the $k$-space image.}
  \label{fig:kspace}
\end{figure}

\section{Pulse sequences and contrast}

As we have seen, MR images are acquired by measuring signals within the spatial frequency dimension, $k$-space, from which we can retrieve the spatial image via a \gls{2dft} operation.
Pulse sequences, meaning specific arrangements, durations and magnitudes of the \gls{rf} pulses, field gradients, and signal readout, encode the trajectory and resolution in which data-points in $k$-space are measured (Fig. \ref{fig:mprage}).
MR imaging is a stunningly diverse modality.
Beyond the basics of spatial encoding and echo signal generation, there lies a whole host of techniques for generating specific contrasts, neutralising unwanted signals and artefacts, and accelerating acquisition times which are outside of the scope of this introduction.

\begin{figure}[htb!]
  \includesvg[width=\textwidth]{chapter_1/mprage.svg}
  \caption{A simplified pulse sequence diagram representing an \gls{mprage} $T_1$-weighted acquisition. This popular acquisition uses a 180\textdegree \gls{ir} \gls{rf} pulse, followed after inversion time TI by an excitation--acquisition sequence, to enhance the contrast between tissues based on their different $T_1$ relaxation times. (In reality, multiple image echos are sampled using fast imaging techniques in-between repeated \gls{ir} pulses.) Multiple signal echos are sampled with decreasing \gls{pe} gradient strengths $G_p$ to build up an entire 2D image.}
  \label{fig:mprage}
\end{figure}

The modification of pulse sequence parameters enables the production of images in which different physiological properties dominate the image contrast, the principal ones being the tissue-specific relaxation time constants $T_1$ and $T_2$, as well as the density of protons.
The development of novel pulse sequences and contrasts is a perennial and active field of research which will continue to expand and improve the capabilities of \gls{mri} for years to come.
Here we will focus on the few fundamental contrasts directly relevant to this thesis.
From (\ref{eq:recovery}), the signal at $t=TE$ in a spin-echo sequence is described approximately by
\begin{equation}
  S(\text{TE}) \propto M_0 (1-e^{-\text{TR}/T_1})e^{-\text{TE}/T_2}
\end{equation}
where TR is the repetition time between successive \gls{rf} excitations and $M_0$ is proportional to \gls{pd}.
With a very long repetition time ($TR\gg T_1$) the $M_z$ term tends to 1 for all tissues, and the contrast between them based on their different $T_1$ properties disappears.
Paired with an echo time of $TE\approx T_2$, the resulting image will be characterised by the differences in $T_2$ between tissues and is therefore said to be \textit{$T_2$ weighted}.
Similarly, very short echo times ($TE\ll T_2$) produce images with no $T_2$-based tissue contrast, and when $TR\approx T_1$ the image will be \textit{$T_1$ weighted}.
Finally if both $TR\gg T_1$ and $TE\ll T_2$ then contrast derived from different relaxation properties disappears altogether, producing a \gls{pd} weighted image.

Sequences with $T_1$ or $T_2$ weighted contrast are some of the most common sequences employed in clinical and research \gls{mri} as they can produce images with high resolution and anatomical detail (Fig. \ref{fig:ortho}).
Alongside these so-called ``conventional" contrasts exist a large collection of advanced imaging techniques that are sensitive to particular tissue properties or activity.%
\footnote[2]{The term ``contrast" is also associated in clinical contexts with the use of external agents (typically injected) with paramagnetic properties that shorten local $T_1$ times and increase image brightness particularly in blood vessels and in areas of \gls{bbb} disruption, making it an important tool in oncological imaging. This will be referred to specifically as \gls{dce} \gls{mri}, or simply contrast enhancement, where applicable, while here we will use ``contrast" more generally to refer to manipulation of pulse sequence elements to highlight different tissue properties.}
\Gls{fmri}, for example, involves the detection of subtle contrast changes produced by changes in the relative concentrations of oxygenated and deoxygenated blood, which have different magnetic properties and influence the local magnetic field accordingly.
A spike in neural activity within a particular region causes increased flow of oxygen rich blood to that area, and the resulting local magnetic field disturbances have a measurable effect on proton relaxation, producing a \textit{blood oxygentation level dependent} (BOLD) signal.
\Gls{fmri} is an important clinical and research tool for measuring association between activity in particular brain areas and observable behaviour or stimuli, such as motor activity, speech, or visual inputs.
Additionally, by analysing temporal correlations between activation in different brain regions, we can deduce functional connectivity between them and establish a model of brains functional network.

Establishing that two brain regions' neural activity is temporally correlated isn't enough to confirm the existence of a direct structural connection between them, as their correlation may be incidental, or mediated by a third intermediate node.
And while \gls{fmri} is a key tool for identifying eloquent cortex for neurosurgical planning, the paucity of blood vessels within \gls{wm} and \gls{fmri}'s low spatial resolution make it unsuitable for mapping \gls{wm} fibres.
The only tool available for non-invasively imaging the microscopic structure of \gls{wm} \textit{in vivo} is \glsentrylong{dmri}.

\begin{figure}[hbt!]
  \includesvg[width=\textwidth,pretex=\ttfamily\small]{chapter_1/anat_ortho.svg}
  \caption{Orthogonal slices (from left to right: Sagittal, coronal, axial views) of a $T_1$-weighted \gls{mri} acquisition of the author's brain, with key anatomical features and landmarks labelled. a. spinal cord, b. medulla, c. pons, d. midbrain, e. cerebellum, f. hypothalamus, g. thalamus, h. lateral ventricle, i. third ventricle, j. fourth ventricle, k. subcortical white matter, l. cortical grey matter, m. corpus callosum, F. frontal lobe, P. parietal lobe, O. occipital lobe, T. temporal lobe, S. central sulcus.}
  \label{fig:ortho}
\end{figure}

\section{Diffusion weighted \gls{mri}}\label{sec:dmri}

% \note{First describe diffusion in general but stick to tissue, i.e. restricted diffusion. Cover the different types of diffusion in different tissues in the brain, timescales etc.
% Then look at the mechanism of \gls{dmri} acquisition, pulse sequence and parameters e.g. b values.
% Also mention common artefacts.}

Molecules in a fluid travel through their environment in a stochastic pattern of thermal motion, and this incoherent motion is the basis for the contrast formed in \gls{dmri}.
In a pure, unlimited volume, the mean squared displacement $x$ travelled in time $t$ is described in three dimensions by a material specific property, the diffusion coefficient $D$:
\begin{equation}
  \langle |\mathbf{x}|^2 \rangle = 6Dt
\end{equation}
Water molecules in living tissue are not as free to diffuse for long distances in all directions as they would be in a pure, endless medium.
The presence of cell membranes, cytoskeletons, organelles and other microstructural barriers reduces the theoretical distance a diffusing molecule can cover within a given timeframe as it has to navigate around obstacles, resulting in a \textit{hindered diffusion} pattern with a lower \gls{adc}.
If the environment poses such unsurmountable barriers to diffusion that, after a sufficiently long time, the mean displacement will appear to plateau, then a \textit{restricted diffusion} pattern is observed where $D$ becomes dependent on the diffusion time and geometry of the limiting environment \autocite{LeBihan1986,LeBihan1995}.
% The notable exception for neuroimaging is \gls{csf}, in which, over the timescales relevant to \gls{dmri}, water diffusion is free and unrestricted. \note{true?}
% Elsewhere in the brain, the presence of highly organised biochemical structures, cell membranes, and cytoskeletons, places varying degrees of restriction \note{hindering?} on the diffusion of water molecules.
In \gls{gm}, the cell membranes of somata, glial cells, dendrites and axons as well as subcellular structures and organelles all present obstacles to diffusing molecules, resulting in a hindered diffusion pattern.
However, since these barriers are arranged in a random fashion, and are to be encountered in any direction with equal likelihood, there is no preferential direction in which diffusion is freer than in others, thus the diffusivity is \textit{isotropic}.
In \gls{wm}, conversely, the highly coherent arrangement of axons poses very strong restrictions on diffusion occurring perpendicular to those axons, while diffusivity is relatively unhindered along the direction parallel to the bundled axon fibres.
In such an environment, diffusion is \textit{anisotropic}, biased towards certain directions over others.

That molecular displacement, both passive diffusion effects and active perfusion (such as the flow of \gls{csf} and blood\autocite{LeBihan1988}), has an effect on measured MR signals was known some time before those effects were harnessed as a form of contrast weighting.
\textcite{Hahn1950} described in 1950 how diffusion attenuates the measured spin-echo signal, as spins diffusing through field inhomogeneities aren't refocussed by the 180\textdegree\ pulse.
While the effect is typically small with standard sequences, any MR pulse sequence can be modified to introduce stronger sensitisation to Brownian motion, or diffusion weighting, in addition to the existing $T_1$ and $T_2$ based contrasts.
Most commonly this is achieved with a spin echo sequence and the addition of a pair of strong diffusion sensitisation gradient pulses of equal length and polarity separated by the 180\textdegree\ \gls{rf} refocussing pulse prior to echo generation and signal readout.

To illustrate the concept, we will consider the application of diffusion weighting along a single orthogonal direction, e.g. $x$.
After slice selection and \gls{rf} excitation, a gradient of magnitude $G_d$ is applied along $x$ for time period $\delta$, followed by the 180\textdegree\ pulse and a second gradient pulse for a further duration $\delta$.
Consider a spin which is stationary along $x=x_1$ throughout the activation of these gradients.
Initially, it will gain a phase $\phi_1$ proportional to its position along the gradient $x_1$ according to $\gamma G_d \delta x_1$.
After magnetisation inversion and application of the second gradient, having not changed position $x=x_2=x_1$ it will accumulate the opposite phase $\phi_2 = -\phi_1$, reversing the effect of the first gradient, resulting in a net phase change of $0$ due to diffusion sensitisation.
Now consider a spin in net motion along $x$ which will consequently be subjected to different gradient magnitudes across the two time points.
It will experience a net dephasing of
\begin{equation}
  \Delta\phi = \gamma G_d (\int_0^{\delta} x(t) dt - \int_{\Delta}^{\Delta+\delta} x(t) dt)
\end{equation}
where $\Delta$ is the time separating onset of the two gradient pulses.
When $\Delta\phi < 0$ refocussing will be incomplete, attenuating the spin echo amplitude accordingly.

Following diffusion sensitisation, spatial encoding and image formation proceed as in standard sequences, and those voxels in which diffusion is high will have have a high degree of diffusion weighting-induced dephasing and exhibit a corresponding signal dropout.
In those voxels with low diffusion, phase coherence will remain relatively intact after diffusion sensitisation and signal loss will be correspondingly minimal.
The signal magnitude at echo time is determined in simplified terms by
\begin{align}
    S = S_0e^{-bD}
\end{align}\label{eq:S}
where $S_0$ is the baseline signal value without diffusion weighting, $D$ is now the effective, or apparent diffusion coefficient\autocite{Basser1994,Beaulieu2002} (a quantity that depends on the molecular environment and includes both diffusion and other incoherent motion effects) and $b$ is the gradient factor summarising the effects of all gradient pulses, first described in \textcite{LeBihan1986} and since commonly termed the $b$-value.
The above description follows the spin-echo pulse sequence proposed by Stejskal and Tanner in 1965\autocite{Stejskal1965}, one of the earliest \gls{dmri} sequence designs.
Modern \gls{dmri} sequences vary in the precise pattern of diffusion weighting gradients and refocussing pulses, so the $b$-value provides a sequence-independent summary of the effective diffusion weighting factor.
In the Stejskal-Tanner sequence we have $b = \gamma^2 G_d^2 \delta^2 (\Delta-\delta/3)$.
The choice of $b$-value is highly influential on the final image, and typically values in the range 600--3000~s~mm$^{-2}$ are used.
Higher $b$-values reflect stronger diffusion sensitisation, but also produce far noisier images, require longer echo times, and require more advanced scanner hardware and gradient instrumentation\autocite{Tournier2011}.
Values up to 1000~s~mm$^{-2}$ are more common in routine and clinical settings, balancing optimal diffusion dependent contrast with acceptable \gls{snr}, while higher values are included in more advanced research methods\autocite{Roberts2007}, where the longer diffusion times provide higher sensitivity to tissue-specific diffusion processes and better angular resolution for the advanced imaging techniques described in Chapter \ref{chap:neuroimaging}.
Acquisitions may also combine multiple $b$-values in a so-called ``multi-shelled" scheme, which can tease apart the effects of hindered and restricted diffusion compartments\autocite{Clark2002,Assaf2005}.

A single \gls{dmri} volume only applies a diffusion weighted gradient of fixed strength along a single orientation, with all signal samples reflecting the diffusivity along that specific direction.
As diffusion in much of the brain is anisotropic, it cannot be assumed in general that the diffusivity would be the same if observed along a different direction.
The simplest \gls{dmri} acquisition, which is employed routinely in diagnostic radiology, obtains three source image different volumes with diffusion weighting along orthogonal directions along with the baseline $b_0$ image, which are combined to produce a \textit{trace weighted} image.
\begin{equation}
  S_{tw} = S_0 e^{-b(D_{xx} + D_{yy} + D_{zz})/3}. \label{eq:trace}
\end{equation}
Alternatively, a map of \textit{average diffusion coefficient} (\glsentryshort{adc}) or mean diffusivity may be computed according to
\begin{equation}
  \text{ADC} = -b^{-1} ln (\frac{S_{tw}}{S_0}). \label{eq:adc}
\end{equation}
In modern acquisitions, including those required for the high angular resolution techniques we will encounter in Chapter \ref{chap:neuroimaging}, anywhere from 12 to 100s of directions are measured, and the number of scans may be additionally multiplied by repeating and averaging signals to boost \gls{snr}.
Consequently, \gls{dmri} scan times can be exceedingly long, from several minutes for clinical sequences into hours for advanced research studies, prompting efforts to reduce scan time by means of accelerated and parallel imaging techniques.

\subsection{Representing spherical functions}
\label{sec:sh}

Diffusion signal analysis and studying macroscopic \gls{wm} structure require describing quantities distributed in the three dimensional angular domain.
If the shape of the function is not generally known, then an arbitrary function may be represented in a suitable function space, defined by a set of orthogonal basis functions.
Analogous to the use of the basis vectors $\mathbf{e}_1=(1\,0\,0)^T, \mathbf{e}_2=(0\,1\,0)^T, \mathbf{e}_3=(0\,0\,1)^T$ to represent any other vector
$\mathbf{v}$ in $R^3$ as $\mathbf{v} =  (v_x\,v_z\,v_z)^T = v_x\mathbf{e}_1 + v_y\mathbf{e}_2 + v_z\mathbf{e}_3$,
so can basis functions be combined to represent any other function in that space.

\begin{SCfigure}
  \includegraphics[width=0.6\textwidth]{chapter_1/SH.png}
  \caption{Visualisation of the first four orders (in rows) of the \gls{sh} basis functions. Positive and negative lobes are coloured grey and yellow respectively. Image adapted from the original by \citeauthor{Inigo.quilez2014}, licensed under \href{https://creativecommons.org/licenses/by-sa/3.0}{CC-BY-SA 3.0}, via Wikimedia Commons}
  \label{fig:sh}
\end{SCfigure}

Throughout this thesis, we will represent spherical functions using the spherical harmonic basis defined on the 2-sphere $S^2$.
The solutions to Laplace's equation in spherical coordinates, the \glspl{sh} are widely used across physics, engineering and mathematics, and are given in complex form in for non-negative integer orders $l = 0, 1, 2,...$ and integer phase factor $-l \leqslant m \leqslant l$ as

\begin{align}
  Y_l^m(\theta,\phi) = \sqrt{ \frac{2l+1}{4\pi} \frac{(l-m)!}{(l+m)!} } P_l^m(cos\phi)e^{im\phi}
\end{align}

where $P_l^m(x)$ are the associated Legendre polynomials.
In \gls{dmri} analysis, including for representing axon fibre orientations, a simplified set of \gls{sh} functions can be used.
We will consider only real valued functions, and under the assumption that diffusion processes are antipodally symmetric, only the even orders $l = 2 \mathbb{N} = 0,2,4,...$ are included\autocite{Descoteaux2006}.
This modified basis set is then given by
\begin{equation}
  Y_{lm} = \begin{cases}
              \sqrt{2} \; \Im (Y_l^{-m}) & \text{if } -l \leq m < 0 \\
              Y_l^0                      & \text{if } m=0 \\
              \sqrt{2} \; \Re (Y_l^m)    & \text{if } 0 < m \leq l
           \end{cases}, \label{eq:sh}
\end{equation}
where $l = 2\mathbb{N}$ and $\Re$ and $\Im$ denote the real and imaginary parts respectively.

An arbitrary function $f(\theta,\phi)$ defined on the sphere can then be defined as a linear combination of $Y_{lm}$:
\begin{equation}
  f(\theta,\phi) = \sum_{l=0}^{\infty}\sum_{m=-l}^{l} c_{lm}Y_{lm}(\theta,\phi) = \sum_j^{\infty} t_jY_j(\theta, \phi) \label{eq:shfun}
\end{equation}
with $j = \frac{1}{2}l(l+1) + m$.
In practical applications, only a finite number $N = \frac{1}{2}(l_{\text{max}}+1)(l_{\text{max}}+2)$ of coefficients $c_{lm}$ can be determined, up to a maximum order $l_{\text{max}}$.
A higher maximum order can represent more angular detail, however due to this truncation our representations as a finite series can only ever be close approximations of the full function $f$.

\subsection{Echo planar imaging}
\label{sec:epi}

Aside from the cost and practicalities of the longer scans needed for \gls{dmri}, there is also the increased risk of motion artefacts as subjects tire or become uncooperative in the scanner.
To achieve orders of magnitude shorter scan times than with conventional sequences in which a single step of phase encoding (or single line in $k$-space) is sampled per excitation, \gls{dmri} scans usually use a fast imaging technique called \gls{epi}, in which all phase encoding steps are acquired after only a single \gls{rf} excitation.
In one example of an \gls{epi} pulse sequence, the phase and frequency encoding gradients are switched on to move the signal to a corner of $k$-space immediately prior to readout, then the readout gradient alternates polarity while the \gls{pe} gradient is ``blipped" on each switch\autocite{Wielopolski1998}.
The result is a stepped zig-zag traversal of all of $k$-space during the readout of a single signal echo.
Measuring enough samples in the extremely short time available before the signal decays requires very strong and rapidly switching gradients, placing significant demands on scanner hardware\autocite{Bowtell1998}.

\begin{figure}
  \includesvg[width=\textwidth]{chapter_1/dwepi.svg}
  \caption{Diffusion weighted \gls{epi} pulse sequence diagram, with diffusion gradients, drawn in dark grey to differentiate them from orthogonal slice, phase and frequency encoding, either side of a 180\textdegree \gls{rf} inversion pulse. All orthogonal gradients may be combined to produce diffusion weighting along an arbitrary direction. An entire slice of $k$-space is acquired from a single echo train, using a strong switching frequency encoding gradient $G_f$ to encode lines along $k_x$, combined with ``blipped" phase encoding gradients $G_p$ to advance the signal through $k_y$.}
  \label{fig:dwepi}
\end{figure}

Fitting the entire image readout into a single magnetisation decay period results in relatively long total acquisition times per excitation.
The pixel bandwidth in the \gls{pe} direction is the inverse of this total acquisition time, and the resulting low pixel bandwidth is associated with particular imaging artefacts.
Local differences in magnetic susceptibility within the sample cause field inhomogeneities, leading off-resonance phase shifts geometric image distortions termed \textit{susceptibility artefacts} \autocite{Fischer1998}.
These are particularly strong at interfaces between substances with large susceptibility differences, such as the air--tissue boundaries around the sinuses in the human head, and can compromise the results of a neuroimaging experiment if not appropriately corrected for.
