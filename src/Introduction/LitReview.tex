\chapter{Review of Literature}
\label{review}

Having given a brief introduction to the principles neuroanatomy and \gls{dmri} physics and image formation, we will turn now to the modern developments in applying \gls{dmri} to qualitative and quantitative analysis of \gls{wm} organisation.
This chapter will take us through early to state-of-the art uses of \gls{dmri} as a \gls{wm} imaging tool and outstanding challenges, followed by a review of key relevant concepts in neurosurgery.

\section{Diffusion MRI analysis}\label{sec:wms}
%==================================

Though the tools for studying the structure and function of neural connectivity are numerous, \gls{dmri} remains the only available technique capable of investigating microscopic \gls{wm} structure of the entire human brain \textit{in vivo}.
% This is thanks to the \note{fibrous} organisation of \gls{wm} fibres, which group together in bundles forming a restrictive diffusion environment in which axon membranes and myelin sheaths form barriers to diffusing water molecules.
% The resulting anisotropic diffusion pattern, with preferential diffusion along the axon direction, forms the basis for \gls{dmri}-based \gls{wm} analysis.
Though the mechanism of diffusion weighted signal is well understood (see section \ref{sec:dmri}), its correct interpretation hinges on an understanding of how diffusion is affected by the microstructural environment\autocite{LeBihan1995}, or even by just those features of the microstructural environment we are interested in measuring.
It is not obvious, for example, how much of diffusion within a voxel filled with myelinated axons can be best characterised as either hindered or restricted, and how properties such as axon density and diameter might contribute to the observed signal.\autocite{Panagiotaki2012}

\gls{dmri} image \glspl{voxel} are on the order of cubic millimetres, and in such a volume are contained thousands of individual axons, with average diameters of around 1$\mu m$\autocite{Liewald2014,Lampinen2019}.
What's more, rarely are all axons within a voxel uniformly aligned with a single direction.
Throughout the brain, fibre tracts mingle and intersect, bend and fan out.\autocite{Jeurissen2013,Alexander2019}
The physical diffusion processes in such complex configurations and multicellular environments cannot be known, only approximated and modelled through a choice of assumptions and simplifications.
In this there are, of course, many contrasting approaches, developed for different applications and the directed study of specific quantities and microstructural features.
Such target properties of \gls{dmri} analysis include cellular composition of \gls{gm}, axon density and myelination, intra- and extracellular water content, and diffusivity perpendicular to axonal orientation.
Collectively, these scalar parameters are fit from a family of microstructural models known collectively as multi-compartment models, so named for their separation of the measured signal into isolated compartments representing, for example, intra-axonal or extracellular space, each with different diffusion patterns.\autocite{Panagiotaki2012,Alexander2019}
These parameters could capture virtual cytohistological information and even serve as biomarkers for disease\autocite{Alexander2008}.
For the purposes of studying macroscopic brain connectivity and the course and organisation of individual \gls{wm} fibre tracts, the key information of interest to be determined from raw \gls{dmri} is the distribution of axonal orientations within each voxel described by a \gls{fod}.

\subsection{Tissus microstructure  and fibre orientation modelling}

The first approach for modelling fibre orientations came in the form of \gls{dti}, which remains one of the dominant diffusion models in many applications today, particularly in clinical contexts.
The diffusion process within a \gls{wm} voxel is modelled as a three dimensional gaussian distribution, whose covariance matrix is proportional to the diffusion tensor\autocite{Basser1994,ODonnell2011} in equation (\ref{eq:dt}).
By diagonalising this matrix, which is symmetric and positive-definite, three orthogonal eigenvectors and corresponding eigenvalues $\lambda_1 \geqslant \lambda_2 \geqslant \lambda_3$ can be computed.
Rotationally invariant indices including mean diffusivity \gls{fa} provide scalar quantities which can be interpreted in terms of underlying tissue properties, the latter being given by
\begin{equation}
  FA = \sqrt{\frac{3}{2}}\frac{\sqrt{(\lambda_1 - \langle \lambda \rangle)^2 + (\lambda_2 - \langle \lambda \rangle)^2 + (\lambda_3 - \langle \lambda \rangle)^2}}{\sqrt{\lambda_1^2 + \lambda_2^2+ \lambda_3^2}}
\end{equation}
The principle eigenvector $\bm{\lambda}_1$ is usually interpreted as the direction of fastest, or least restricted, diffusivity, although this holds only in voxels with a single population of straight, parallel axons.
If the diffusion tensor, whose eigenvectors and eigenvalues can be represented in the form of a zeppelin shaped surface of equal mean displacement, is used as a rudimentary approximation of the \gls{fod}, then $\bm{\lambda}_1$ is taken as the single peak orientation of axon fibres.
In fact, it is rare for a voxel of \gls{wm} to contain only a single uniformly oriented bundle of axons.
In so-called crossing fibre voxels, where at least two distinctly oriented fibre populations reside, the diffusion tensor provides a woefully inaccurate or misleading picture: a smaller population with a low signal contribution may be entirely unrepresented in the modelled \gls{odf} peak, or else the effect is one of averaging all contributing populations such that none of the actual underlying fibre directions are indicated by the \gls{dt} eigenvectors.

The crossing fibres problem led to \gls{dti}, at least in research imaging, gradually giving way to higher-order fibre orientation modelling techniques which aim to account for more than one, or even an arbitrary number of distinctly oriented fibre populations\autocite{Alexander2005}.
These include to an extent the multi-compartment models which can include multiple directional intra-axonal compartments, such as the popular ``ball and sticks" model\autocite{Behrens2003,Behrens2007}.
Alternatively, several approaches aim to retrieve an underlying orientation distribution with arbitrary number of peaks through transforming the raw signal \gls{odf} into a spherical distribution of diffusivity or correlates thereof.
Diffusion spectrum imaging (DSI)\autocite{Wedeen2008}, and the less data-demanding Q-ball imaging\autocite{Tuch2003,Tuch2004}, are examples of methods that reconstruct a distribution of water molecule displacement (\gls{dodf}), with peaks aligned with the (presumed) fibre orientation.
Deconvolution methods begin with the premise that a single population of parallel fibres will produce a characteristic \gls{dmri} signal profile.
Then, the observed signal $S(\theta,\phi)$ in a given voxel amounts to a convolution over the fibre orientation distribution function $F(\theta,\phi)$ with this single fibre ``response" kernel $R(\theta)$:
\begin{align}
  S(\theta,\phi) = F(\theta,\phi) \otimes R(\theta)
\end{align}\label{eq:csd}
Solving (\ref{eq:csd}) for $F(\theta,\phi)$, represented in spherical harmonics basis as given by (\ref{eq:shfun}), involves computing the inverse operation: A spherical \textit{de}convolution of the signal with the response function.
Early versions of this concept included \textcite{Anderson2005}, in which the response kernel was modelled as a diffusion tensor.
In another approach presented by \textcite{Tournier2004} $R(\theta)$ is estimated directly from the data, generally by averaging the signals from voxels with the highest diffusion anisotropy, and thus does not rely on a model of diffusion, although it does rely on the assumption that a single fibre population's response is uniform throughout the brain and for different fibre configurations.
To improve angular resolution and reduce noise sensitivity in the estimated \gls{fod}, a regularised implementation in which biophysically impossible negative $F(\theta,\phi)$ values are strongly penalised gave rise to the widely used \gls{csd} method.
\Gls{csd} can reconstruct \glspl{fod} resolving multiple crossing fibre populations with high angular resolution in a matter of seconds, from \gls{dmri} datasets with acquisition parameters achievable in routine imaging practice\autocite{Tournier2013}.
In addition to providing a means for estimating the \gls{fod} to a high degree of angular resolution, \gls{csd} also spurred exploration of new quantities relating to tissue microstructure, notably the interpretation of the \gls{fod} amplitude as measure of intra-axonal volume fraction, or \gls{afd} \autocite{Raffelt2012a}.
\Gls{afd} can be defined as a directional quantity or as a single scalar per voxel, obtained by integrating $F$ over the sphere.

By design, \gls{csd} presumes that the entire signal in a voxel can be explained by contributions from a number of fibre populations, each forming a highly restrictive environment in which diffusion is anisotropic.
Within pure and highly organised \gls{wm}, this is a reasonable assumption, however limitations become apparent outside of these areas.
As we have seen in previous sections, brain tissue covers a spectrum of cytoarchitectures and a corresponding diversity in diffusion environments.
At the typical resolutions of \gls{dmri} data, voxels may contain, in addition to axon fibres, signal contributions from \gls{csf} or \gls{gm}, which are typically characterised by isotropic and freer diffusion.
The result of such partial volume effects are highly noisy \gls{fod} estimates with spurious peaks, overestimation of \gls{fod} peak amplitudes and overestimation of \gls{afd} in affected voxels.\autocite{Jeurissen2014}
In addition, the original \gls{csd} method was designed only for data acquired with a single diffusion weighting $b$ factor (``shell"), unable to take advantage of the additional information contained in more advanced and increasingly popular multi-shell acquisitions.
To address these limitations, an extension proposed in \textcite{Jeurissen2014} and referred to as \gls{msmt} \gls{csd} includes support for multiple $b$-value shells and separation of the signal into contributions from different tissue compartments, typically \gls{wm}, \gls{gm}, and \gls{csf}, each with their own characteristic response functions.
The resulting \gls{fod} estimates have higher angular precision than \gls{ssst} \gls{csd}, with fewer noisy spurious lobes to confound downstream processing and interpretation.
Furthermore, separation of the isotropic signal contributions greatly improves the interpretation of \gls{fod} amplitude as a measure of \gls{afd}, as the amplitudes of each tissue's deconvolved \gls{odf} closely correspond to their respective tissue volume fractions\autocite{Jeurissen2014}.

\subsection{Streamline tractography}\label{sec:tractography}

% \note{Discuss as the mainstay of white matter bundle segmentation.
% Cover fundamentals (including what it isn't), det/prop, different fibre models, virtual dissection, the usual suspects}

Up to this point, we have only discussed the processing and analysis of \gls{dmri} data, and what it can or cannot reveal about \gls{wm} microstructure, at the level of individual image \glspl{voxel}.
However, the individual axons that form fibre tracts can traverse 100s of millimetres, and with the unique ability to measure fibre orientations in each voxel it wasn't long before this information was being exploited to reconstruct axonal connections in their entirety.
The basic principle is one of treating fibre orientations as a brain-wide vector field through which the paths of virtual neural fibres can be traced in a process called streamline tractography.
It is vital to note here that the paths of individual \textit{in vivo} axons are entirely indiscernible from \gls{dmri}.
The individual streamlines of tractography are entirely abstract mathematical objects, each a collection of vertices, which aim to capture the \textit{potential} pathways of axons consistent with the observed \glspl{fod} representing an ensemble of thousands of axons.
Tractography is an immensely powerful and useful tool, and at the same time full of flaws due to this abstract and indirect nature.
All tractography algorithms consist at their core of the following steps:

\begin{lstlisting}[language=bash, frame=single]
streamlines = []
while length(streamlines) < N do
  streamline = [get_seed_vertex()]
  STOP = false;
  while not STOP
    vertex = streamline[end]
    v = get_local_direction(vertex)
    new_vertex = vertex + step_size*v
    append(streamline, new_vertex)
    STOP = evaluate_stop(new_vertex)
  append(streamlines, streamline)
\end{lstlisting}

Within this simple algorithm are a plethora of parameters and decisions which which have transformative effects on the result.
They are apparent in the undefined functions such as \verb|get_local_direction()| or \verb|get_seed_vertex()| and the scalar parameters \verb|step_size| and \verb|N|.
The seed location, step length, conditions for terminating or entirely rejecting streamlines, interpolation of the surrounding vector field, number of streamlines to generate, are all choices to be made by the user (although in practice many parameters will be automatically determined or set to default values by the chosen algorithm).
There are two choices that most fundamentally affect the tractography process and which feature most heavily in discussions on its use.

First is the choice of method for representing orientation information from the underlying data.
The earliest tractography algorithms were developed almost concurrently with \gls{dti}\autocite{Mori1998,Mori1999}, with the orientation vector field constructed from the principle eigenvectors of fitted diffusion tensors.
In the \gls{fact} algorithm proposed by \textcite{Mori1999}, the local direction for each vertex is assigned from $\bm{\lambda}_1$ of the current voxel, and the stop criterion is a measure of neighbourhood fibre collinearity falling below a predefined threshold.
With only a single possible propagation direction at each location, which, as discussed above, may throughout much of the brain have little to do with any true axon orientations at that point, diffusion tensor-based tractography can only track fibre pathways with rather limited accuracy.
Streamlines may continue happily along a physiologically plausible path until encountering a region of intersecting tracts, at which point it may be prematurely terminated or diverted onto the trajectory of this intersecting tract if a continuation of the current path is entirely unsupported by the principle eigenvector field.

It becomes clear when considering what we learned about neural connections in section \ref{sec:hodology}, about compact fibre bundles diverging to distributed cortical targets, that a single dominant fibre direction at every point is incompatible with the dynamic organisation of \gls{wm} tracts, and the result is a tendency to reconstruct narrow and incomplete fibre bundles\autocite{Farquharson2013}.
A well cited example of this limitation can be seen in reconstructions of the \gls{cst}, which arises from the entire motor cortex from the apex down to the Sylvian fissure, but which is rendered by \gls{dt}-based algorithms only as a vertical pathway without any lateral projections.
Against this background, tractography based on higher-order fibre orientation models represents a vast improvement in the ability to contend with tracking in the complex configurations of \gls{wm}.
Now when two perpendicular tracts occupy the same voxel, the possible tracking direction is not limited to either that of the dominant bundle such that tracking the smaller one is impossible, or of an average of the two such that neither is properly represented.
However, with the flexibility of multi-peak distributions comes ambiguity, as when there are multiple distinct possible directions in which to propagate the streamline at any position, the decision of which direction to take becomes far more complex.
While tensor-based tractography may be particularly prone to false negatives, or neglecting certain pathways, multi-peak tractography can easily produce false-positives by hopping onto the paths of intersecting tracts.

The second significant distinction is between deterministic and probabilistic tracking approaches.
In deterministic tractography, there is only one single direction in which a streamline can be propagated from any given point, and two streamlines seeded in exactly the same location will be identical.
But the certainty implied by this deterministic approach is at significant odds with the reality that tractography operates in a domain and resolution far removed from that of individual axons.
Probabilistic tractography algorithms are here to acknowledge the uncertainty inherent in the tracking process.
Numerous probabilistic tracking algorithms have been developed, and while the end effect is essentially the same, whereby the next step direction is sampled from a probability distribution instead of deterministically selected, and seeding in the exact same location will not give rise to identical streamlines, there are two subtly different schools in what sort of uncertainty is being considered\autocite{Jeurissen2019}.
One considers the \textit{measurement} uncertainty of the calculated orientations.
Under this approach, the general direction to take is not under question, but the accuracy of that direction is.
It holds that due to noise and inherent limitations in our measurement equipment and signal modelling, the fibre orientations can only be calculated with limited accuracy, and the tracking directions are sampled from a distribution reflecting this measurement uncertainty.
The probabilistic algorithm probtrackx\autocite{Behrens2007}, based on the ball-and-sticks fibre orientation model\autocite{Behrens2003}, is a notable example of this approach.

A second school takes the view that uncertainty in the choice of streamline step direction stems from the obscurity of the underlying physiological reality, and sampling that direction from the fibre \gls{odf} reflects that microstructural complexity.
Crucially though, tracking is not proceeding under any guidance relating to real biophysical connections, and though a streamline's direction in a given voxel may well be in accordance with real axons, whether that direction is appropriate in the context of the preceding steps of the same streamline is unresolvable.
In other words, \gls{fod}-based probabilistic tractography, of which first or second-order integration over FODs (iFOD1/iFOD2)\autocite{Tournier2012,Tournier2010} are notable examples, can capture the local dispersion of fibres in high detail, but that doesn't necessarily translate to long-range accuracy.
It is possible to constrain tractography according to broad heuristics about fibre tract geometries, but inevitably such simplifications will not be globally applicable.
For example, strategies to prevent streamlines from ``hopping" onto intersecting, but not physically connected, pathways can include placing upper limits on the angle between successive steps under the expectation that most tracts will carry more or less straight on, but there are plenty of tracts in the brain with regions of high curvature, which become much harder to accurately reconstruct if the ``straight ahead" constraint is too strict.

Due to streamline tractography's locally oriented and step-by-step nature, errors and missteps accumulate rapidly with little to no opportunity to correct them, resulting in some wildly implausible streamlines.
Attempts to address this blindness to biophysical reality are at the focus of much of modern tractography research\autocite{Bastiani2017,Rheault2019,Aydogan2021}, as the consequences of these ongoing challenges to connectivity research and neurology are substantial\autocite{Schilling2019, Yang2021, Grisot2021}.

\subsection{White matter segmentation part 1: Tractography}

The functional division of white matter into distinct tracts is of great consequence to neuroscience, psychology and neurology in their efforts to analyse brain structure and function, and as we will see later, identifying tracts is also of vital importance in neurosurgery.
It follows that the spatial delineation of individual tracts is a key step in many \gls{dmri} analysis pipelines.

Streamline tractography was the first, and remains the dominant answer to this task.
Though the field is wide and the specific approaches numerous, we will outline the two main frameworks through which individual tract segmentations are derived using streamline tractography.
The first, sometimes dubbed ``virtual fibre dissection", involves generating a large number (on the order of 10s of millions) of streamlines, usually covering the entire brain, followed by a selection process whereby streamlines are assigned to a tract of interest or discarded.
Streamline tracking proceeds virtually uninhibited, terminating only if a maximum length is reached or when leaving the white matter (as indicated by tissue segmentations\autocite{Smith2012} or a \gls{fod} amplitude threshold).
After tracking, one approach for selecting streamlines belonging to the target bundle is to use logical \glspl{roi}, specifying inclusion volumes which must be visited and exclusion volumes to filter unwanted tracks.
These selection and exclusion \glspl{roi} encapsulates our \textit{a priori} neuroanatomical knowledge, and the resulting bundle, comprising only those streamlines fulfilling the criteria, represents the segmented tract.
The streamlines may be viewed as three-dimensional objects, or further processed into volumetric streamline density maps\autocite{Calamante2010} and thresholded binary segmentations.

Alternatives to \gls{roi}-based selection are clustering methods, which classify streamlines according to their proximity or similarity to each other, or other geometrical properties.
RecoBundles\autocite{Garyfallidis2018}, White Matter Analysis \autocite{ODonnell2017, ODonnell2007}, atlas based adaptive clustering \autocite{Tunc2014}, and example-based automatic tract labelling \autocite{Yoo2015} are all examples of data driven, group-wise streamline clustering and matching approaches.
They typically rely on registration of example data or streamline atlases based on which similar streamlines are recognised in the target data and labelled accordingly.
Reference tracts can also be used to optimise seed placement according to streamline similarity metrics \autocite{Clayden2006,Clayden2009}.
Streamline clustering methods have been shown to generate more consistent and reproducible results across subjects compared to \gls{roi}-based segmentation\autocite{Sydnor2018}.
Another approach, named Classifyber, uses a learned linear classification of streamline features to label streamlines belonging to the target bundle in a new subject \autocite{Berto2021}.
In all clustering approaches, the necessary generation of whole brain tractograms in test subjects and the additional construction of example or reference tractography data present barriers to application, as well as, in some cases, long processing times and high memory requirements\autocite{Wasserthal2018}.

The whole brain approach is computationally extremely wasteful, as the vast number of streamlines generated will not even represent \textit{any} anatomically valid pathway through the brain, let alone one belonging to the tract of interest.
Furthermore, if streamlines are randomly seeded throughout the brain, then longer tracts covering a larger volume are more likely to be sampled, the tendency to continue straight along a ``path of least resistance" at diverging or crossing fibres results in inordinate overrepresentation of certain pathways\autocite{Smith2013}.
All this means that, after perhaps hours of tracking and billions of streamlines created, only a handful may be included in a final bundle reconstruction.

The second approach may be called ``targeted tractography", an involves only seeding streamlines in a tract-specific \gls{roi} and retaining those that fulfil tract-specific selection criteria, provided as additional inclusion and exclusion regions, until a target number of streamlines have been selected.
A seed region can but does not necessarily have to be placed at one of the actual anatomical ends of the tract, and in some cases it makes more sense to seed from the middle of the tract and propagate bidirectionally, placing additional include regions at the ends to ensure complete coverage.
This approach does not mean that no streamlines are discarded (seeded fibres may be terminated before fulfilling all inclusion criteria, or stray into exclusion regions) but targeted seeding and selection certainly leads to a higher number of admissible streamlines being generated in far less computational time than in the whole brain approach, while discarding unwanted streamlines on the fly reduces storage requirements.
Targeted tractography is the more common approach particularly in applications where only a few or even just a single tract are relevant, such as in neurosurgery\autocite{Yang2021}.

Manual placement of \glspl{roi} in both whole-brain and targeted pipelines represents a significant intellectual burden, relies on expert anatomical knowledge and can be extremely time consuming, so it is often automated by registering structural atlases and defining tracts in terms of logical relations to atlas structures, as in TractQuerier\autocite{Wassermann2016} or a similar proposed method using fuzzy logic\autocite{Delmonte2019}, and Tracula \autocite{Yendiki2011}, or pre-defined \glspl{roi}, as in XTRACT \autocite{Warrington2020}.
The former two are examples of methods that rely on comprehensive cortical parcellations, typically obtained with a software tool such as FreeSurfer which can take many hours to run.
In many scenarios, manual \gls{roi} placement remains the default method, particularly in clinical contexts where automatic \gls{roi} registration or segmentation may fail due to pathology.
Here, not only is a good understanding of the anatomy of a tract is vital to produce high quality reconstructions, but the user will also need to understand the biases and pitfalls of their chosen \gls{fod} model and tractography algorithm to ensure proper interpretation and qualification of the results\autocite{Rheault2020,Rheault2022}.
Even to an experienced user, producing quality bundles is often time-consuming and tedious.
While modern research applications and increasingly more clinical applications almost exclusively favour probabilistic and multi-fibre \gls{odf} algorithms thanks to higher sensitivity to complex fibre configurations\autocite{Yang2021}, an inevitable trade-off is a high prevalence of false positive streamlines, representing either irrelevant or unphysical connections.
Filtering out these unwanted streamlines remains a considerable challenge\autocite{Jorgens2021}.
Attempts to reduce their creation in the first instance include injecting more anatomical priors into the tracking process, such as by modifying \glspl{fod} to favour the directions associated with the target tract\autocite{Rheault2019}, using directional \glspl{roi} for particularly tricky geometries \autocite{Chamberland2017}, or designing alternatives to the piece-wise linear tracking paradigm that aim to generate streamlines with more anatomical plausibility \autocite{Schomburg2017,Aydogan2021}.
Finally, due to a combination of the different computational methods available, and a general lack of consensus on the precise anatomical extents of many commonly reconstructed pathways, tractography suffers from notoriously low reproducibility\autocite{Schilling2021a}.

In view of these limitations, some in the field are continuing efforts to improve streamline tractography with novel tracking algorithms, finding new ways to incorporate anatomical priors and developing more powerful streamline filtering, clustering and selection strategies.
Others are looking towards white matter segmentation solutions that do not rely on tractography at the point of application, but instead produce voxel-wise tract segmentations directly from \gls{dmri} or \gls{fod} data.

\subsection{White matter segmentation part 2: Direct methods}

There have been numerous works addressing the \gls{wm} tract identification task as a classic voxel-wise segmentation problem, utilising techniques including multi-label supervised clustering \autocite{Ratnarajah2014}, level-set and front propagation\textcite{Nazem-Zadeh2011, Hao2014}, and deep learning for direct segmentation from fibre orientation representations \autocite{Wasserthal2018,Li2020}.
Typically, direct methods require some number of samples with which to train a classifier, atlas, Bayesian model or neural network.

In \textcite{Hagler2009}, a fibre location and orientation atlas is created by averaging the \gls{dt} and tractography-derived information from multiple subjects and subsequently used to estimate the voxel-wise \textit{a posteriori} tract probability in a test subject.
As orientation information was encoded by averaging \gls{dt} principal eigenvectors across subjects this approach is not optimised for crossing fibre configurations.
The spatial probability was given by the averaged, normalised track density values from individual deterministic streamline tractography, although tracking biases discussed above mean that equating streamline density with likelihood of tract location is problematic\autocite{Rheault2019,Smith2013}.
\textcite{Bazin2011} also proposed a direct approach based on diffusion tensor-derived priors (``Diffusion-Oriented Tract Segmentation", or DOTS) also based on \gls{dt} modelling.
Here the atlas orientation prior consisted of a single principal direction per voxel, and comparisons with the test subject data are made using Markov random field models and neighbouring tensor connectivity.

More recent developments have made use of advances in data science techniques including deep learning segmentation models, of which TractSeg\autocite{Wasserthal2018} and Neuro4Neuro\textcite{Li2020} are notable examples, using \gls{fod} peaks and diffusion tensors as inputs, respectively.
Deep learning-based approaches have the advantage of producing highly reproducible results in short processing time, without the need for template or atlas registration.
However, drawbacks of direct, deep learning-based methods which produce binary segmentations include a lack of explainability, and a dependence on large volumes of annotated training data which are labour-intensive to produce.
This limits their flexibility: if a user requires a tract segmentation which is either anatomically different or not covered by an existing pre-trained model, then the necessary production of new training data and subsequent model training represents a high logistical and computational barrier.

Inference models trained on large volumes of healthy data may not be entirely robust to pathologies, particularly those causing significant topological changes.
In addition to healthy data, Neuro4Neuro\autocite{Li2020} was validated only in a dementia dataset, and TractSeg\autocite{Wasserthal2018} was qualitatively validated in schizophrenia and autism datasets in the original work.
TractSeg has also been qualitatively validated in a tumour dataset with mostly successful results, with more complete segmentations in cases with minimally deforming tumours.\autocite{Richards2021}
In \textcite{Moshe2022}, the authors trained their own TractSeg model, on approximately 500 datasets, to segment the \gls{cst} in brain tumour patients.
The results were more reproducible than for the compared manual method, and obtained an average dice similarity score of 0.64, almost 25\% worse than the performance in healthy data reported in the original TractSeg study (for the same tract).
The authors cite a lack of reliable and sufficient labelled training data as a reason for limiting their study to a single tract, despite the importance of other tracts in preoperative fibre mapping.

%########################
%########################
%########################
%########################
\section{Neurosurgery}\label{sec:neurosurgery}
%========================

\subsection{Indications for neurosurgery}

% \note{This is for all the reasons for surgery, including tumour, epilepsy DBS.
% Also more detail into the types of tumours, and locations in the brain}

Many types of interventions fall under the remit of cranial and spinal neurosurgery, including inserting electrodes for \gls{dbs}, diagnostic biopsies, vascular surgeries, and insertion of \gls{csf} shunts.
In all cases, precision is paramount and tools for accurate navigation form vital components of the surgical workflow.
The following review will focus on some of the most complex and invasive procedures, involving the removal of tumours and epileptogenic brain tissue.
In England between 2013--2018, oncological procedures were the third most common of all neurosurgery subspecialties comprising approximately 9\% of total, while functional neurosurgeries (including for epilepsy and deep brain stimulation) made up 8\%\autocite{Wahba2022}.
At \gls{gosh} in London, a leading centre of paediatric care, 10\% of neurosurgeries taking place between 2018--2022 were tumour related, while 12\% were for epilepsy\autocite{gosh2023}.

Invasive brain tumour surgeries are both highly complex and variable in presentation, neurophysiology, microbiology, treatment plans, and prognosis.
Such diversity presents a significant barrier to the development of image processing methods intended for generalised use in tumour patients\autocite{Bauer2013}.
For one, neoplasms occur throughout the brain, with the location having unique impacts on surrounding structures and associated functions.
A tumour's natural history and histopathology also plays a large role in determining its effects on its environment.
Malignant gliomas, a category of tumours arising from glial cells, often have complex structures, with infiltrating components and peri-tumoural oedema blurring the distinction between tumour and non-tumour tissue\autocite{Weller2021}.
On the other hand, many non-malignant tumours including most meningiomas and low grade astrocytomas, are entirely encapsulated, with clear demarcation from neighbouring from brain tissues, which are displaced instead of infiltrated\autocite{Lu2004,Gerard2017}.

This project is concerned with the visualisation of cerebral white matter tracts, and therefore this review with focus on those indications and interventions in which damage to and navigation of such structures is of particular concern.
This is typically not the case for posterior fossa and suprasellar lesions, although there is growing interest in the role of the cerebellum in wider cognition and the brain functional network, and the surgical community is paying increasing attention on the effects of posterior fossa surgery on cerebellar tracts\autocite{Toescu2021,Skye2023}.
Brainstem tumours are often not candidates for surgical removal due to their precarious locations, with limited access and excessive risk to vital brainstem function.
The discussions in this section therefore apply primarily to supratentorial lesions in the cerebral hemispheres and thalamus, candidates for biopsy or resection via craniotomy.
The most common intracranial tumours are meningiomas, arising from the protective membranes surrounding the \gls{cns}, of which the majority are benign with good overall survival rates and relatively low-risk surgical treatment \autocite{Rogers2015,Spena2022}.
Far more complex and in places controversial are decisions surrounding the surgical treatment of gliomas, those tumours originating in glial cells including astrocytes and oligodendrocytes which are also among the most common \gls{cns} primary neoplasms in both adults\autocite{Ostrom2015,Wanis2021} and children\autocite{Ostrom2015}.
While challenges regarding functional preservation and optimal surgical strategy are relevant to all intracranial surgeries, they are acutely highlighted within the context of glioma treatment literature.
These tumours can embed themselves insidiously within the brain's functional architecture with devastating prognosis, facing oncologists and surgeons with stark dilemmas in their bid to maximise patient survival and quality of life.
Gliomas are classified by the \gls{who} into four malignancy grades, commonly split into \gls{lgg} (\gls{who} grades 1-2) and \gls{hgg} (\gls{who} grades 3-4) to reflect differences is aggressiveness and prognosis.
There are many subtypes based on histological and genetic characteristics which are periodically updated\autocite{Louis2021}, but this overview will stick with the broad categories of \gls{hgg} and \gls{lgg}.

\subsection{Extent of resection}

One might understandably assume that the goal of neurosurgical resection would be the total removal of target lesions, yet things are not so simple.
While the ideal outcome may, in many cases, be the complete removal of all pathological tissue, this scenario would frequently be in conflict with other equally important outcome indicators, such as the health of surrounding brain structures and patient wellbeing.
Successfully balancing these trade-offs is a central dilemma in neurosurgical practice, with the key measure being \gls{eor}, the amount of tumour or epileptogenic brain tissue removed.
In theory, \gls{eor} is a straightforward concept, but in practice it is ill-defined and inconsistently measured, while remaining central to studies of surgery efficacy and outcomes.

Easily defined in oncology as either the absolute volume or relative percentage of tumour tissue removed, accurately determining \gls{eor} is essentially impossible.
It is often reported in terms of broad categories, the most common being biopsy, \gls{str} or partial resection (PR), near total resection, \gls{gtr} and supratotal resection\autocite{Wykes2021,Karschnia2021}.
There is also no general consensus on how these categories are defined, making comparison between studies even more difficult\autocite{Karschnia2021}.
Many studies simply give very rough percentage values as estimated visually by the operating surgeon or a radiologist based on whether or not tumour residue is visible in the resection cavity or on a postoperative scan, with limited accuracy\autocite{Sanai2008,Martino2013,Lau2018,Sezer2020}.
Over time, the definitions for \gls{eor} have evolved with the availability of techniques for measuring it, and the current accepted standard for quantifying \gls{eor} is with volumetric measurement on pre- and postoperative imaging\autocite{Rincon-Torroella2019}, but here too practices are inconsistent\autocite{Wykes2021}.
Full volumetric analysis requires accurately segmenting the entire lesion, though sometimes \gls{eor} is calculated by simply taking the diameter of the lesion on a single or multiple slices, or with approximate ellipsoid segmentation\autocite{Sanai2008,Albuquerque2021}.
% This also can't account for resected portions of the tumour being filled with fluid, or differing amounts of tissue compression caused by mass effect and postoperative brain shift.

Even manual delineation can be unreliable and inconsistent, especially for tumours with poorly defined borders and on postoperative imaging \autocite{Ertl-Wagner2009,Bo2017,Visser2019}.
Semi- or fully automatic segmentation improves reproducibility\autocite{Ertl-Wagner2009,Sezer2020} and modern algorithms are proving ever more accurate, although there are still challenges regarding computational performance and robust clinical translation\autocite{Angulakshmi2017,Wadhwa2019,Fawzi2021}.
Estimates of \gls{eor} can also be thrown off by post-operative brain tissue shifting and obscuring the actual volume of resected tumour \autocite{Schucht2014a}, while microscopic tumour cell invasion means that complete resection, as viewed either on imaging or by intraoperative visual assessment, does not necessarily mean no tumour residue remains\autocite{Yordanova2017}.
Finally, while there is the most focus on reporting relative reductions in tumour volume as a percentage of original size, more recent studies have argued that absolute residual tumour volume is as, if not more relevant for determining postoperative outcomes\autocite{Ius2012,Rincon-Torroella2019,Smith2008,Karschnia2021}.

\subsection{Oncological and neurological outcomes: Necessarily in opposition?}

Inconsistent reporting of \gls{eor} is one factor complicating the study of its effects on clinical outcomes, even as there is widespread agreement on the importance of studying those effects\autocite{Rincon-Torroella2019,Wykes2021,Weller2021}.
% \note{defs: lgg = grades 1-2, hgg = grades 3-4, glioblastoma = grade 4 glioma}
% For many tumour types, particularly aggressive tumours such as \glspl{hgg}, subtotal resection is \note{never} curative even with adjuvant therapy.
Broadly speaking, \gls{gtr} has been shown to increase overall and progression free survival over \gls{str} across age groups in both high \autocite{Hatoum2022, Han2020, Adams2016, McCrea2015, Bloch2012, McGirt2009, Kramm2006} and low grade \autocite{Keles2001, Pollack1995, Sanai2008} gliomas.
For \gls{lgg}, and especially in paediatric patients, \gls{gtr} has become the recommended standard of care, as complete resection leads to a lower chance of recurrence\autocite{Berger1994,Claus2005}.
In particular, maximal resection of \glspl{lgg} drastically reduces the risk of residual tumour evolving into \gls{hgg} (known as malignant transformation)\autocite{Duffau2013,Hervey-Jumper2016,Rincon-Torroella2019}.
More recent voices have even argued for supratotal resection, beyond the margins of any abnormally enhancing areas on T1w and FLAIR T2w \gls{mri} scans, as reviewed in \textcite{deLeeuw2019}.
There is some evidence, as published in \textcite{Yordanova2011}, to suggest that supratotal resection in \glspl{lgg} is followed by fewer cases of malignant transformation and improved progression-free survival.

However, due to a general lack of prospective randomisation and robust comparison with appropriately matched controls, drawing definitive conclusions from studies investigating the effects of \gls{eor} (or other surgical variables) on post-operative outcomes is contentious\autocite{deLeeuw2019,Keles2001}.
Results may be confounded by selection biases, for example, different tumour histological subtypes may lend themselves more or less easily to greater \gls{eor}, or arise more frequently in eloquent areas of the brain (which include cortex and subcortical \gls{wm} subserving language, memory, motor, and sensory functions, as well as the thalamus and brain stem), where an aggressive surgical strategy is likely to be discounted\autocite{deLeeuw2019}.
\Glspl{lgg} tend to occur more frequently than \glspl{hgg} in highly eloquent cortical regions\autocite{Duffau2004}, indeed the control group for the supratotal \gls{lgg} study\autocite{Yordanova2011} mentioned above consisted of patients whose gliomas were located in eloquent brain areas, and who therefore underwent only \gls{gtr}.
One might therefore expect supratotal resection to be associated with worse postoperative neurological outcomes, and indeed \textcite{Rossi2019a} found higher probabilities of immediate postoperative deficits in supratotal versus total resection of \glspl{lgg}.
These were however significantly reversed at three month and one year follow-ups, and initial overall evidence suggests that neuropsychological outcomes are comparable between total and supratotal groups\autocite{Tabor2021}.

In adults with glioma, maximal safe resection, combined with adjuvant radio- and chemotherapy, has been the established standard of care for some time.
It has been less clear, however, whether the same should apply in paediatric patients.
For one thing, the most prevalent anatomical locations in which gliomas arise may differ between adults and children\autocite{Duffau2004}.
Thalamic gliomas, for example, are more frequent in children than in adults\autocite{Cinalli2018,Palmisciano2021,GomezVecchio2021}:
Adult gliomas are located most frequently in the hemispheres, mostly the frontal lobe, with only approximately 4-7\%\autocite{GomezVecchio2021,Larjavaara2007} situated in the thalamus, while as many as 19\% of paediatric \glspl{hgg} are thalamic\autocite{McCrea2015}.
There is also concern that oncological differences between adult and paediatric type gliomas preclude safe extrapolation of treatment plans from one patient group to the other\autocite{Jones2012,Greuter2021}.
% Adult LGG 31\% eloquent Jakola2012
% Adult mixed grade 2-3 65\% "presumed eloquence" GomezVecchio2021 ; 80\% eloquent adult LGG Greuter2021
In addition to paediatric tumours frequently arising in high-risk areas such as thalamus and brain stem \autocite{Ostrom2015},  neurocognitive and functional preservation is an especially critical concern in children.
A meta-analysis published in 2022 analysed 37 articles to assess the association between \gls{eor} and survival in paediatric patients with \gls{hgg}\autocite{Hatoum2022}.
Notwithstanding the difficulties in consistently defining and reporting \gls{eor} as discussed above, the study found strong evidence for improved overall survival in \gls{gtr} over \gls{str} of gliomas located in the cerebral hemispheres, but no association between \gls{eor} and survival was observed in midline cases.
The authors emphasise that midline (thalamic and brain stem) gliomas are not often indicated for aggressive resection due to the elevated risk to critical neurological function, and the lack of observed association may stem from measurement biases, including lower sample size and the pooling of histologically distinct tumour types which may respond differently to treatment.
Moreover, no comparison was made for postoperative functional neurological outcomes, thus failing to capture the full picture of factors contributing to a decision to pursue radical surgery.

New postoperative neurological deficits occur in over one third of glioma surgeries \autocite{Zetterling2020a}, although most patients improve significantly over longer-term followup.
Unsurprisingly, higher chances of postoperative deficits were associated with higher \gls{eor} and with tumours situated in eloquent areas\autocite{Zetterling2020a}.
In \textcite{Gil-Robles2010}, authors argue for a more conservative resection margin in WHO grade 2 gliomas (low-grade) to protect functional structures, although current consensus recommends total resection in \gls{lgg} wherever possible\autocite{Rincon-Torroella2019,Albuquerque2021}. %but this is not the dominant opinion
For the most malignant tumour types, even maximal resection combined with adjuvant therapy is practically never curative, and may only lead to increases in survival of just a few months\autocite{Rincon-Torroella2019,Karschnia2023}.
Given the overall poor survival outcomes associated with aggressive gliomas, oftentimes the risks to quality of life and postoperative neurological function associated with pursuing \gls{gtr} outweigh any potential oncological benefits\autocite{Rahman2016,Tabor2021}.
In \glspl{hgg}, one of the most aggressive forms of cancer, the justification for \gls{gtr} or even supratotal resection is weaker than in \gls{lgg}, given that it cannot secure long-term survival for affected patients.
Where radical resection carries no likely oncological benefit and is contraindicated by a high functional risk to eloquent areas, the goal of surgery may be conservative debulking of the lesion to relieve pressure on the brain and reduce current neurological symptoms.
% In certain types of tumour, particularly when a combined treatment approach of surgery and radiotherapy is taken, little evidence has been found that \gls{gtr} offers greater tumour-related (that is to say, neurological condition affected by the presence of the tumour) outcomes than subtotal resection, while increasing risk to surrounding brain tissue.
% On the other hand, certain types of tumour, in particular lower grade and less aggressive types, show a lower risk of recurrence and malignant transformation when radically resected, offering a particularly good long-term outlook.
With the widespread evidence of an oncological advantage associated with more extensive resection, physicians have increasingly advocated for \gls{gtr} as the standard treatment for \gls{lgg} and maximal safe resection for \gls{hgg} \autocite{Rincon-Torroella2019}.
But this comes with the caveat that tumours of lower malignancy are also often those found to be more operable, muddying the causal link between overall survival and extent of resection\autocite{Weller2021}.
What's more, post-operative neurological deficits, due to cortical and subcortical injury, themselves have a negative impact on overall survival, independently of differences in pre-operative symptoms \autocite{Trinh2013,Rahman2016,Rincon-Torroella2019}.
Hence even if only overall survival is considered as the measure of treatment success, the evidence that both neurological injury and un-resected tumour negatively impact survival highlights the dilemma of surgically treating tumours in eloquent brain regions\autocite{Rincon-Torroella2019,Duffau2004,Rahman2016}.
The European Association of Neuro-Onocology's recommendation, as of 2021, is that prevention of new neurological deficits should be prioritised over maximal extent of resection in the surgical treatment of gliomas\autocite{Weller2021}.

A further consideration on the feasibility of \gls{gtr} or supratotal resection is neuroplasticity\autocite{Duffau2005}.
Slowly growing, low-grade, or recurring tumours may lead to functional reorganisation of surrounding brain tissue\autocite{Takahashi2012,Southwell2016,Das2019} or compensatory recruitment of equivalent contralateral regions\autocite{Mitolo2022}, enabling the safe removal of a greater margin of tissue than would otherwise be accepted for eloquent areas\autocite{Rossi2019a}.
Current understanding of neuroplasticity and brain tumours is limited to a small number of case studies, and more systematic research into the mechanisms and robust detection of functional reorganisation are required before these findings can be put into routine clinical practice\autocite{Duffau2005,Abel2015,Satoer2017}.
Taken together with the emergence of a hodological framework for neurosurgery discussed in Section \ref{sec:hodology}\autocite{Sala2019}, improved study of neuroplasticity could gradually lead to wider applicability of total or supratotal resection without compromising on neurological function and postoperative quality of life.

Early neurological concepts of rigid functional localisation formed the basis for the concepts of eloquence and operability of tumours guiding neurosurgeons throughout much of recent decades.
The recent move towards a more individualised view has only been made possible through developments in imaging and functional monitoring tools, allowing clinical teams to adapt the surgical strategy to each unique brain-tumour system, rather than relying on received assumptions about functional organisation\autocite{Boerger2023}.
The next section will explore some of those advanced technologies instrumental in the planning and execution of state-of-the-art neurosurgical practice.

% Overall view: moving goal posts, as changes in classifications of glioma and new understanding of mutations and associated risk, changing priorities from topological to hodological mapping and considering neuroplasticity, selection bias, ...

\subsection{Surgical planning and preoperative imaging}

Tumours can interact with their surroundings in a number of ways, depending on their nature and location.
Some tumours, including some \glspl{lgg} and meningiomas, are fully encapsulated and displace surrounding brain as they grow.
This strong distinction between tumour and healthy tissue can simplify surgical treatment as it is not necessary to risk functioning neural tissue while resecting infiltrating tumour, but such tumours can exert dangerous amounts of pressure on displaced tissues, leading to neurological impairments and urgent need for surgical debulking.
Others cause almost no spatial displacement of brain tissue, with cancer cells instead invading the parenchyma and blurring the boundaries between disease and healthy brain.
Infiltrating tumours pose a particular surgical challenge due to the risk of injury to eloquent tissue, and may only be conservatively debulked and treated with adjuvant radiation or chemotherapy.
In order to meet the goal of safely balancing maximal resection and functional preservation, the full tumour-brain interaction must be comprehensively mapped to determine the optimal resection margin.

% \paragraph*{Preoperative imaging}

Preoperatively, structural and functional non-invasive imaging are used for diagnosis and, if surgery is indicated, surgical planning.
At this stage the goal is to assess the spatial and functional relationships between diseased and healthy tissues, map out a safe operative corridor to access the lesion, and determine the appropriate \gls{eor} under all considerations explored in the previous section.
Structural imaging with \gls{ct} and \gls{mri} provide critical anatomical information in high spatial detail.
Multi-contrast \gls{mri}, including FLAIR, T1w and T2w imaging sequences, each provide unique contrasts for visualising different aspects of a tumour, such as necrotic and infiltrating regions, which can aid in determining tumour type, what \gls{eor} to aim for, or which region of the tumour to target for biopsy.
Angiography, detailed mapping of blood vessels with \gls{ct} and specialised \gls{mri} sequences, can also be employed for determining a tumour's vasculature and identifying major vessels involved\autocite{Kashimura2008,Kim2019}.
\Gls{fmri} and navigated transcranial magnetic stimulation \autocite{WeissLucas2020} map out eloquent cortex lying in proximity to the lesion, including the motor, language, and sensory cortices, supplementing the purely structural data obtained from conventional \gls{mri} or \gls{ct}.
In epilepsy patients, \gls{eeg} may be employed to monitor epileptogenic regions\autocite{Sarco2006}.

\gls{dmri} is playing an ever-increasingly important role for neurosurgical planning and navigation\autocite{Manan2022}, especially as focus moves from functional localisation towards to viewing the brain as an interconnected network.
Tumour and \gls{wm} interactions are varied and can be difficult to distinguish on conventional contrast \gls{mri} alone.
Depending on the infiltrative nature of a lesion, \gls{wm} tracts may be displaced due to mass effect, invaded but remain functionally intact, disrupted or destroyed, or experience a combination of effects\autocite{Essayed2017,DSouza2019,Manan2023}.
\gls{dmri} can be instrumental in differentiating these circumstances and assessing tract integrity\autocite{Field2004,Manan2023}, but care must be taken to recognise how tumour effects may disturb diffusion patterns and impact the results.
Peri-tumoural oedema and invading cells can lead to drastically altered diffusion signal measurements and reduction of anisotropy, complicating their interpretation and inhibiting accurate streamline tracking\autocite{Bulakbas2009,Nimsky2010,Kuhnt2013}.
Nevertheless, \gls{dti} and streamline tractography have brought dramatic improvements to neurosurgical planning, unlocking detailed visualisations of \gls{wm} tracts and their spatial relationships to the surgical target and even acting as a predictor of postoperative deficits with implications for preoperative patient counselling\autocite{Manan2022}.
This potential was recognised almost immediately, with \gls{dti} and early tractography quickly making their way into clinical practice \autocite{Lee2001,Mori2002a,Nimsky2005}.
% \paragraph*{White matter mapping}
%%%% --! The below may be picked up as plagiarism; heavily copied from HBM manuscript; check academic regulations !--
In the intervening years, research imaging has largely transitioned to the multi-fibre models and probabilistic algorithms described in Section \ref{sec:wms}, but in clinical practice tractography is frequently still based on \gls{dt} fibre orientation models \autocite{Toescu2020, Yang2021} and deterministic tracking algorithms.
As a notable example, popular neuronavigation platform provider Brainlab's iPlan\textregistered{} (single tensor)\autocite{Brainlab2012} and Elements (dual tensor)\autocite{Sollmann2020a} Fibre Tracking applications (Brainlab AG, Munich, Germany) use a version of the probabilistic \gls{fact} algorithm \autocite{Mori1999}.

Regardless of the particular combination of fibre model, algorithm and tracking criteria, streamline tractography is compromised by weaknesses that can lead to flawed results or interpretations if not accounted for\autocite{Rheault2020, Schilling2022, Schilling2019}.
The same techniques and associated limitations for reconstructing individual \gls{wm} bundles already described apply here too, and can even be exasperated by additional tumour-related effects.
\gls{dt}-based tractography, already afflicted by low sensitivity in healthy applications, often encounters particular difficulties tracking through oedema and areas of infiltration even where intact and functioning fibres may persist\autocite{Leclercq2010}, leading to missed connections and dangerous blind spots in the very regions at risk during surgery, where accurate navigation is most critical \autocite{Kuhnt2013,Ashmore2020}.
Meanwhile, the high propensity for false positive streamlines typical of probabilistic algorithms can be even more difficult to manage when tumour deformations disturb normal fibre orientations and inhibit accurate placement of \glspl{roi}\autocite{Yang2021}.

Perhaps clinical translation of multi-fibre probabilistic tractography has also been muted on account of its lower ease of use and practicality.
DT acquisitions can have as few as 6 diffusion weighted directions, resulting in much shorter scan times compared to full HARDI scans.
Deterministic tracking itself is rapid, and the placement of \glspl{roi} need not be as strict as with probabilistic tractography owing to a lower sensitivity to false positives \autocite{ODonnell2017}.
A general lack of availability of the necessary expertise and time limits neurosurgical centres' access to state-of-the-art tractography \autocite{Toescu2020}.
Until recently, commercially available neurosurgical navigation platforms have exclusively supported \gls{dt} modelling and deterministic tractography (a recent exception is the Medtronic Stealth\texttrademark{} S8 Tractography application (Medtronic, USA), which implements \gls{csd}-based tractography\autocite{Pozzilli2023} as well as DT).
This lack of readily available alternatives in the neurosurgeon's workflow and certified for safe clinical use is undoubtedly a major factor in the persisting preference for deterministic methods in clinical practice.
Nonetheless, there is growing consensus that (pending appropriate regulatory approval) the clinical community ought to adopt probabilistic, non-DT tractography\autocite{Yang2021, Beare2022, Petersen2017}.
There is evidence that this shift is gradually underway, at least in the context of presurgical planning\autocite{Toescu2020}, driven probably by a combination and feedback loop of growing demand and better availability and integration of advanced techniques into the clinical workflow.

\subsection{Neuronavigation and brain shift}

During the surgical procedure itself, multimodal information streams continue to guide the safest possible resection.
Functional monitoring with \gls{des} is a crucial component of neurosurgical workflows and widely considered the gold standard for localising neural function after craniotomy.
Electrical current is applied to the cortical surface at increasing strengths\autocite{Saito2015}, and where stimulation elicits a functional response or disruption, the corresponding region is deemed eloquent.
Additionally, stimulation of subcortical white matter behind the resection cavity wall can be used to indicate when surgery should be halted as underlying eloquent structures are approached\autocite{Sala2019}.
\gls{des} can be utilised in awake or asleep paradigms.
In the former, patients are awakened after craniotomy, and perform structured cognitive tasks involving those cortical hubs that may be at risk while undergoing electrical stimulation.
It is commonly considered for \gls{lgg} treatment within the UK, and to a lesser extent for \gls{hgg}\autocite{WykesV.2017}.
Language function is perhaps the most common target for awake stimulation as well as high-level motor tasks (such as playing an instrument) and vision\autocite{Mazerand2017}.
Awake surgery is technically complex, psycho-cognitively and emotionally demanding of the patient, and not universally tolerated\autocite{Nossek2013a,Wang2019}.
In very young children, awake surgery is rarely possible except in the most cooperative and resilient patients, and with appropriate preparation\autocite{Zolotova2022}.
\gls{des} may also be performed in asleep patients, albeit limited to assessing motor and somatosensory function, where stimulation elicited somatosensory or motor evoked potentials (SSEPs, MEPs) can be measured in the patient's sensory cortex or muscles\autocite{Stone2019} (although the effects of anaesthesia can limit the sensitivity and accuracy of this approach\autocite{Stone2019,WeissLucas2020}).
There is also a considerable risk of intraoperative seizures, particularly in younger patients, which can lead to failure of awake functional mapping and potential increased risk of postoperative deficits\autocite{Nossek2013,Wang2019,Rigolo2020a}.

Imaging and functional data acquired in preparation for surgery is not only instrumental to surgical planning, it also serves to guide the surgeon throughout the procedure, providing real-time multidimensional navigational information to supplement their live view through the surgical microscope.
Image guidance can involve simply displaying preoperative imaging and mapping in the theatre, while more advanced systems can also indicate the positions of surgical tools, or overlay imaging information on the microscope view.
This is achieved through stereotactic image guided surgery, where the patient's head is either fixed within a stereotactic frame, or affixed with fiducial markers on the skin surface, which are tracked, along with the surgical tools, by an infrared camera system\autocite{Sattur2019}.
Fiducials in the image are registered to the operating room coordinate system, allowing the tools' positions to be mapped into the image coordinate system.
Intraoperative navigation with preoperative \gls{fmri} and \gls{dti} or tractography can improve \gls{eor} and preservation of critical cortical and subcortical function\autocite{Wu2007,Bello2008,Bello2010d}, particularly when combined with \gls{des} or awake surgery\autocite{Aibar-Duran2020}.
Where awake surgery is contraindicated or abandoned, preoperative functional mapping remains the only guidance available for higher cognitive functions, playing a crucial role in improving surgical care for patients who would not qualify for awake surgery.
\textcite{Rigolo2020a} found that preoperative \gls{fmri} guidance enabled safe resection of tumours or epileptic foci to continue after failed or incomplete \gls{des} function mapping, with no significant difference in postoperative morbidity.

Maximising \gls{eor} has further been significantly improved with the introduction of 5-aminolevulinic acid (5-ALA) guidance.
This compound is administered orally prior to surgery and is converted within cells to protoporphyrin IX (PPIX), which fluoresces when excited by short wavelength light.
Uptake of 5-ALA is highest in tumour cells due to \gls{bbb} disruption, and the metabolic pathways producing PPIX are more active in tumour cells, allowing the surgeon to distinguish them from healthy tissue under the surgical microscope.
5-ALA guided surgery results in improved \gls{eor} and higher progression free survival, while maintaining preservation of functional tissue\autocite{Coburger2019,Golub2020}, and has seen widespread uptake in the surgical treatment of gliomas\autocite{Stummer2006}.

The dynamic conditions of brain surgery result in the unpredictable and often substantial movement, compression and deformation of tissue referred to as brain shift.
A range of factors contribute to this phenomenon, including \gls{csf} drainage, sagging due to gravity, decompression of tissue surrounding the resection cavity, swelling, craniotomy herniation and the effects of surgical instruments\autocite{Gerard2017}.
These factors may act in competing directions and combine in complex ways, for example swelling and tumour debulking can cause brain shift towards the craniotomy, while gravity and \gls{csf} drainage may have the opposite effect\autocite{Roberts1998}.
With the magnitude and direction of brain shift being so unpredictable, ranging from 1mm to as much as 50mm\autocite{Gerard2017}, accounting for it with predictive modelling is very difficult\autocite{Bayer2017b}.

Brain shift can affect the neurosurgeon's perception of the shape and location of the target lesion and invalidate preoperative imaging used for navigation\autocite{Nimsky2000}.
Many neurosurgeons rely on intuition to update their mental map of the surgical site throughout the procedure.
On more advanced neuronavigational platforms which integrate preoperative imaging and intraoperative data such as \gls{des} stimulation sites, brain shift can lead to misleading and inaccurate depictions of the spatial relationships between tumour and surrounding structures.
In particular, accurate localisation on image-guided navigation systems of deep tumour margins and the functionally eloquent structures beyond is significantly compromised by brain deformation and cannot be as easily mentally compensated for by the neurosurgeon as visible surface movements\autocite{Nimsky2000}.
Numerous techniques have been proposed to address the problem of brain shift\autocite{Bayer2017b} by dynamically adjusting preoperative imaging with patient specific deformation modelling.
Some rely entirely on preoperative imaging in combination with predictive modelling to simulate deformations, others include sparse or alternative modality intraoperative data, including sparse tracking of cortical surface features\autocite{Luo2019}, optical imaging of the cortical surface\autocite{Skrinjar2002,Audette2005,Fan2017} and intraoperative \gls{us} \autocite{Letteboer2005,Reinertsen2007,Bucki2012,Machado2019}, to estimate brain shift and update preoperative imaging accordingly.
Yet \textcite{Yang2017a} found that \gls{wm} tract shift direction was independent of cortical surface shift.
Ultimately, the most accurate 3D patient anatomy information can only be obtained with full 3D structural imaging after brain shift has occurred.

% Options without intraop imaging rely heavily on computationally modelling, with either limited accuracy or high computational time

\subsection{Intraoperative imaging}

To mitigate the effects of brain shift on neuronavigation accuracy, new structural and functional guidance information can be acquired intraoperatively.
Once more, different modalities offer different strengths and weaknesses.
Ultrasound imaging can probe into tissue beyond the surface, is safe, and can be operated at the surgical table without needing to move the patient\autocite{Elmesallamy2019,Eljamel2016}.
Doppler ultrasound is particularly useful for detecting intra- and peritumoural vasculature\autocite{Steno2016}, although image quality is limited and can be difficult to compare with other imaging modalities such as \gls{mri}\autocite{Eljamel2016}.
Specialised \gls{ct} systems can also be utilised intraoperatively \autocite{Bayer2018}, but they cause additional patient exposure to ionising radiation which is to be avoided wherever possible.

\Gls{imri} is becoming an increasingly common and valued addition to neurosurgical set-ups.
This includes low field ($<1T$) open bore systems which can be installed in the operating room, and allow for easy transfer of the patient into the scanner\autocite{Steinmeier1998,Senft2010}, as well as full high-field ($1.5-3T$) systems which acquire far higher quality images with potentially more clinical utility\autocite{Makary2011} at the expense of practicality, as interrupting surgery for an extended scan session and safely transferring a patient from the operating table to inside the scanner bore in an adjoining room is a substantial logistical and medical undertaking\autocite{Senft2010,Giordano2016a,Sattur2019}.
Technical challenges notwithstanding, \gls{imri} is incredibly valuable for determining surgical margins and providing guidance after the effects of brain shift deformations have invalidated preoperative imaging.

Numerous works demonstrate the benefits of \gls{imri} for improving postsurgical outcomes in both tumour and epilepsy surgery, including greater \gls{eor}, fewer new postoperative deficits, greater postoperative seizure freedom, and reduced length of hospital stay in both adults and children
\autocite{Shah2012,Zhang2015a,Sacino2016,Rao2017c,Giordano2017,Lu2018a,Garzon-Muvdi2019,Leroy2019,Karsy2019,Golub2020,Hlavac2020,Englman2021}.
%Giordano2017: safe in children; positioning
Even with advanced image and surgical guidance, postoperative \gls{mri} may show tumour nodules unintentionally left in the brain, concealed in corners of the resection cavity.
In some cases early repeat surgery is required to remove unresected disease, resulting in significant additional clinical burden to the patient, longer hospital stays, heightened risk of complications including wound infection\autocite{Tenney1985,Chang2003}, delays in the planning of adjuvant treatment, and greater financial expense\autocite{Shah2012}.
Intraoperative imaging enables these remaining tumour margins to be detected and fully resected within the same surgery\autocite{Sattur2019,Hlavac2020}.
For low grade lesions, the use of \gls{imri} could mean the difference between a potentially curative procedure and one leaving the patient at risk for recurrence and/or reoperation\autocite{Shah2012}.
Where \gls{imri} indicates no need for further resection, it can replace the need to subject patients to an additional scan immediately following surgery with all the discomfort and possible sedation that would entail.

While there is still some debate over the overall cost to benefit ratio of high-field \gls{imri} systems\autocite{Eljamel2016,Giordano2016a,Giussani2022}, and indeed high initial capital expense remains one of the primary barriers to their installation, cost-effectiveness analyses have indicated that upfront investments are recouped by lifetime savings associated with shorter hospital stays, and improved postoperative recovery and survival\autocite{Giordano2016a,Sacino2018}.
Cost-effectiveness can be further increased with a dual use set-up, in which an \gls{imri} system is used both for intraoperative and routine diagnostic scanning\autocite{Giordano2016a}, as is the case at \gls{gosh}.
Further challenges of implementing \gls{imri} include longer operating times, equipment compatibility, and patient positioning for both navigated surgery and scanning\autocite{Giordano2017}.
It is worth noting that the strength of evidence supporting all \gls{imri} use and cost-effectiveness is still under debate \autocite{Jenkinson2018,Garzon-Muvdi2019,Caras2020}, and interpretation of \gls{imri} studies is confounded by selection bias and a lack of randomised control trials\autocite{Kubben2011}.

% Next: skim open papers; discuss conventional contrast imaging, move to other acquisitions (dwi: infarct etc, then more advanced); compare with iop acquisition of dmri with coregistration (deformable) between preop advanced and intraop structural.
% end with technical considerations (in particular for children), costs etc.
% Note that more research needed to assess intraop diffusion mri.

The majority of \gls{imri} sequences are $T_1$-weighted (with or without injected contrast agent enhancement), $T_2$-weighted, and other conventional acquisitions with good tumour tissue contrast\autocite{Kubben2011,Coburger2019}.
In line with this finding, the majority of literature reviewed surrounding \gls{imri} focusses on evaluating \gls{eor}, and in this regard the technique has gradually established itself as a clearly beneficial and in some centres indispensable surgical aid\autocite{Garzon-Muvdi2019,Hlavac2020}.
What has been less extensively studied is the potential for \gls{imri} to provide updated advanced functional neuronavigation.
Broadly speaking, this can be approached in two ways.
The first is to use conventional \gls{imri} to dynamically adjust preoperative functional information (including \gls{fmri} and tractography) using deformable image registration and/or biomechanical brain shift modelling, the second is to directly acquire new advanced \gls{mri} sequences intraoperatively.
While the former may seem like the preferred choice, as one avoids having to acquire and process additional lengthy scans and further prolonging surgery interruption, achieving robust deformable registration in a reasonable timeframe is by no means trivial, and especially complicated given the significantly disturbed anatomy following craniotomy and complex brain shift.
Intraoperative \gls{fmri} has been reported in a very limited number of studies in \gls{dbs}\autocite{Hiss2015,Knight2015}, tumour resection\autocite{Roder2016a,Qiu2017a}, and neurovascular\autocite{Muscas2019} surgeries, but it's unlikely to find widespread use on account of practicality and an established preference for \gls{des} for cortical mapping.
By contrast, intraoperative \gls{dmri} has several potential advantages.

Use of tractography for neuronavigation is valued by many, but its accuracy diminishes with increasing brain shift, with precision most compromised during later stages of a resection, at the same time as it is potentially approaching critical subcortical \gls{wm}\autocite{Yang2019}.
Some account for this by registering preoperative tractography or \gls{dti} \gls{dec} maps to intraoperative structural \gls{mri}\autocite{Nimsky2006a,Tamura2022}, which depends on robust and accurate registration\autocite{Beare2016}.
Alternatively, intraoperative acquisition of \gls{dti} and even \gls{hardi} scans has been garnering interest.
Early work by \textcite{Nimsky2005}$^,$\autocite{Nimsky2005a} demonstrated the feasibility of intraoperative \gls{dmri} and tractography, illustrating \gls{wm} tract shifting after tumour resection.
Safe resection of tumours and epilepsy foci aided by intraoperative reconstruction of motor\autocite{Maesawa2010,Javadi2017}, language\autocite{DAndrea2016,Li2021} and visual\autocite{Daga2012,Cui2015} pathways has been confirmed in subsequent studies.
Overall, a systematic review found 26 articles reporting intraoperative \gls{dti} or tractography and associated outcome measures, with moderate suggestion of benefit to surgical success \note{cite: Aylmore20??}.

There are considerable technical considerations associated with intraoperative \gls{dmri}, even more so than with routine imaging.
Duration is of course one, with minimum possible scan time a priority for interrupted surgeries.
Secondly, intraoperative \gls{dmri} can suffer from degraded image quality\autocite{Roder2019}, and distortion artefacts common in \gls{dmri} sequences utilising \gls{epi} are exasperated by the tissue--air interface at the craniotomy site\autocite{Elliott2020}, which can significantly diminish the accuracy of \gls{wm} tract localisation\autocite{Yang2022}.
Early studies suggested that intraoperative tract reconstructions may not be not reliable on their own, but useful in combination with adjuvant functional mapping such as \gls{des}\autocite{Ostry2013}.
Nearly all current implementations of intraoperative tractography are limited to commercially available \gls{dt}-based deterministic algorithms, which have known limitations particularly in application to pathology.
Nevertheless, concrete evidence of benefits to postoperative outcomes with intraoperative advanced \gls{dmri} is mounting\autocite{DAndrea2012,Cui2015,Maesawa2010}, and in combination with what we already know about conventional \gls{imri} and preoperative imaging for \gls{wm} neuronavigation, it stands to reason that intraoperative \gls{dmri} could bring significant improvements to brain surgery if some of the technical and image processing limitations can be overcome.

All neuronavigational tools are complementary, each providing distinct streams of information, and where possible, combination of techniques can increase the chances of achieving an optimal outcome.
For example, maximal safe resection with combined 5-ALA and \gls{imri} guidance is recommended by UK national clinical guidelines for surgical treatment of gliomas\autocite{NICE2021}.
Reviews have found similar benefits to \gls{eor} from both \gls{imri} and 5-ALA guidance separately\autocite{Golub2020} and even better outcomes when combined\autocite{Nickel2018,Coburger2019}.
5-ALA provides the surgeon with a direct visualisation of tumour cells in the surgical view, but residual nodules may remain out of sight behind cavity convexities and only show up on \gls{imri}\autocite{SueroMolina2019}.
Combining awake surgery with \gls{imri} is also viable and beneficial in some patients \autocite{Motomura2017,Tuleasca2021}.
Advanced functional mapping, presurgical planning, and intraoperative monitoring, where the appropriate resources and expertise are available\autocite{GeorgeZakiGhali2020}, all increase the operability of highly eloquent gliomas
\autocite{Bello2008,Krieg2013,DellaPuppa2013b,Magill2018}.
